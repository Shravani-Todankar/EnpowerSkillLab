<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>My Profile - Enpower Skill Lab</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="profile.css">
    <!-- Header JS -->
    <script src="header.js"></script>

    <style>
        /* Prevent FOUC - hide containers until loaded */
        #sidebar-container:empty,
        #header-container:empty {
            opacity: 0;
            visibility: hidden;
        }

        #sidebar-container.loaded,
        #header-container.loaded {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.2s ease-in;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Include Sidebar Component -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Include Header Component -->
            <div id="header-container"></div>

            <!-- Profile Page Content -->
            <div class="profile-page">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-header-content">
                        <h1 class="page-title">
                            <span class="material-symbols-outlined page-title-icon">account_circle</span>
                            My Profile
                        </h1>
                        <p class="page-subtitle">View and manage your personal information</p>
                    </div>
                </div>

                <!-- Profile Content -->
                <div class="profile-content">
                    <!-- Profile Header Card -->
                    <div class="card profile-header-card">
                        <div class="profile-header-main">
                            <div class="profile-avatar-section">
                                <div class="profile-avatar-wrapper" id="profileAvatarWrapper">
                                    <img id="profileAvatar" class="profile-avatar-medium"
                                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuDcIJndixMoK4d7aUwjLNvUwGvQtwhoZp4zrBYHVGp_UbVoliCXsHU6Px_N4mBzfACwz3nJ2LpxL3Ws-XZbgIozb_cRIXJSxDOB2E2kzyb17yyplKyWeyRDLc-fj9vfq0_snyn1Sph7cn21sgjjyZvpAiuZIPF2nmJa_WqFLafr9reOBS1SXMU7f3XdOpsHE_wug6-xsGVmdXkOvYSvf5KdZDEIYmVUz-mfuhm5JroeQp4NP7_6_8NM9c77yCwB6A0DQSdxijqgA9Y"
                                        alt="Profile Picture">
                                    <div class="profile-avatar-overlay">
                                        <span class="material-symbols-outlined">photo_camera</span>
                                    </div>
                                </div>
                                <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;">
                            </div>

                            <div class="profile-basic-info">
                                <div class="profile-basic-row">
                                    <div class="profile-basic-item">
                                        <label class="profile-basic-label">Name</label>
                                        <p class="profile-basic-value" id="headerName">Kunal</p>
                                        <input type="text" class="profile-basic-input" id="headerNameInput" value="Kunal" style="display: none;">
                                    </div>
                                    <div class="profile-basic-item">
                                        <label class="profile-basic-label">Email</label>
                                        <p class="profile-basic-value" id="headerEmail">kunal@student.com</p>
                                        <input type="email" class="profile-basic-input" id="headerEmailInput" value="kunal@student.com" style="display: none;">
                                    </div>
                                    <div class="profile-basic-item">
                                        <label class="profile-basic-label">Phone</label>
                                        <p class="profile-basic-value" id="headerPhone">+91 98765 43210</p>
                                        <input type="tel" class="profile-basic-input" id="headerPhoneInput" value="+91 98765 43210" style="display: none;">
                                    </div>
                                </div>
                                <div class="profile-basic-row">
                                    <div class="profile-basic-item">
                                        <label class="profile-basic-label">Student ID</label>
                                        <p class="profile-basic-value highlight">210903</p>
                                    </div>
                                    <div class="profile-basic-item">
                                        <label class="profile-basic-label">Class</label>
                                        <p class="profile-basic-value">9</p>
                                    </div>
                                    <div class="profile-basic-item">
                                        <label class="profile-basic-label">Section</label>
                                        <p class="profile-basic-value">A</p>
                                    </div>
                                </div>
                            </div>

                            <div class="profile-header-actions">
                                <button class="btn-header-toggle" id="headerToggleBtn">
                                    <span class="material-symbols-outlined" id="headerToggleIcon">edit</span>
                                    <span id="headerToggleText">Edit</span>
                                </button>
                                <div class="profile-badges">
                                    <span class="profile-badge active">
                                        <span class="material-symbols-outlined">verified</span>
                                        Active
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Information Grid -->
                    <div class="profile-grid">
                        <!-- Personal Information -->
                        <div class="card profile-section-card">
                            <div class="profile-section-header">
                                <h3 class="profile-section-title">
                                    <span class="material-symbols-outlined">person</span>
                                    Personal Information
                                </h3>
                                <button class="btn-header-toggle" id="personalToggleBtn">
                                    <span class="material-symbols-outlined" id="personalToggleIcon">edit</span>
                                    <span id="personalToggleText">Edit</span>
                                </button>
                            </div>
                            <div class="profile-info-grid">
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Full Name</label>
                                    <p class="profile-info-value editable-field" data-field="fullName">Kunal</p>
                                    <input type="text" class="profile-info-input" data-field="fullName" value="Kunal" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Date of Birth</label>
                                    <p class="profile-info-value editable-field" data-field="dob">15 March, 2010</p>
                                    <input type="date" class="profile-info-input" data-field="dob" value="2010-03-15" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Gender</label>
                                    <p class="profile-info-value editable-field" data-field="gender">Male</p>
                                    <select class="profile-info-input" data-field="gender" style="display: none;">
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Blood Group</label>
                                    <p class="profile-info-value editable-field" data-field="bloodGroup">O+</p>
                                    <select class="profile-info-input" data-field="bloodGroup" style="display: none;">
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Academic Information -->
                        <div class="card profile-section-card">
                            <div class="profile-section-header">
                                <h3 class="profile-section-title">
                                    <span class="material-symbols-outlined">school</span>
                                    Academic Information
                                </h3>
                            </div>
                            <div class="profile-info-grid">
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Student ID</label>
                                    <p class="profile-info-value highlight">210903</p>
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Class</label>
                                    <p class="profile-info-value">9</p>
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Section</label>
                                    <p class="profile-info-value">A</p>
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Roll Number</label>
                                    <p class="profile-info-value">15</p>
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Date of Admission</label>
                                    <p class="profile-info-value">21 November, 2025</p>
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Academic Year</label>
                                    <p class="profile-info-value">2025-2026</p>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="card profile-section-card">
                            <div class="profile-section-header">
                                <h3 class="profile-section-title">
                                    <span class="material-symbols-outlined">contact_phone</span>
                                    Contact Information
                                </h3>
                                <button class="btn-header-toggle" id="contactToggleBtn">
                                    <span class="material-symbols-outlined" id="contactToggleIcon">edit</span>
                                    <span id="contactToggleText">Edit</span>
                                </button>
                            </div>
                            <div class="profile-info-grid">
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Email Address</label>
                                    <p class="profile-info-value editable-field" data-field="email">kunal@student.com</p>
                                    <input type="email" class="profile-info-input" data-field="email" value="kunal@student.com" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Phone Number</label>
                                    <p class="profile-info-value editable-field" data-field="phone">+91 98765 43210</p>
                                    <input type="tel" class="profile-info-input" data-field="phone" value="+91 98765 43210" style="display: none;">
                                </div>
                                <div class="profile-info-item full-width">
                                    <label class="profile-info-label">Address</label>
                                    <p class="profile-info-value editable-field" data-field="address">123, Sample Street, Sample City, State - 400001</p>
                                    <input type="text" class="profile-info-input" data-field="address" value="123, Sample Street, Sample City, State - 400001" style="display: none;">
                                </div>
                            </div>
                        </div>

                        <!-- Parent/Guardian Information -->
                        <div class="card profile-section-card">
                            <div class="profile-section-header">
                                <h3 class="profile-section-title">
                                    <span class="material-symbols-outlined">family_restroom</span>
                                    Parent/Guardian Information
                                </h3>
                                <button class="btn-header-toggle" id="parentToggleBtn">
                                    <span class="material-symbols-outlined" id="parentToggleIcon">edit</span>
                                    <span id="parentToggleText">Edit</span>
                                </button>
                            </div>
                            <div class="profile-info-grid">
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Father's Name</label>
                                    <p class="profile-info-value editable-field" data-field="fatherName">Dinesh Darji</p>
                                    <input type="text" class="profile-info-input" data-field="fatherName" value="Dinesh Darji" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Father's Occupation</label>
                                    <p class="profile-info-value editable-field" data-field="fatherOccupation">Business</p>
                                    <input type="text" class="profile-info-input" data-field="fatherOccupation" value="Business" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Father's Phone</label>
                                    <p class="profile-info-value editable-field" data-field="fatherPhone">+91 98765 00000</p>
                                    <input type="tel" class="profile-info-input" data-field="fatherPhone" value="+91 98765 00000" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Mother's Name</label>
                                    <p class="profile-info-value editable-field" data-field="motherName">Mrs. Darji</p>
                                    <input type="text" class="profile-info-input" data-field="motherName" value="Mrs. Darji" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Mother's Occupation</label>
                                    <p class="profile-info-value editable-field" data-field="motherOccupation">Teacher</p>
                                    <input type="text" class="profile-info-input" data-field="motherOccupation" value="Teacher" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Mother's Phone</label>
                                    <p class="profile-info-value editable-field" data-field="motherPhone">+91 98765 11111</p>
                                    <input type="tel" class="profile-info-input" data-field="motherPhone" value="+91 98765 11111" style="display: none;">
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="card profile-section-card">
                            <div class="profile-section-header">
                                <h3 class="profile-section-title">
                                    <span class="material-symbols-outlined">info</span>
                                    Additional Information
                                </h3>
                                <button class="btn-header-toggle" id="additionalToggleBtn">
                                    <span class="material-symbols-outlined" id="additionalToggleIcon">edit</span>
                                    <span id="additionalToggleText">Edit</span>
                                </button>
                            </div>
                            <div class="profile-info-grid">
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Nationality</label>
                                    <p class="profile-info-value editable-field" data-field="nationality">Indian</p>
                                    <input type="text" class="profile-info-input" data-field="nationality" value="Indian" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Religion</label>
                                    <p class="profile-info-value editable-field" data-field="religion">Hindu</p>
                                    <input type="text" class="profile-info-input" data-field="religion" value="Hindu" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Category</label>
                                    <p class="profile-info-value editable-field" data-field="category">General</p>
                                    <input type="text" class="profile-info-input" data-field="category" value="General" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Previous School</label>
                                    <p class="profile-info-value editable-field" data-field="previousSchool">ABC School</p>
                                    <input type="text" class="profile-info-input" data-field="previousSchool" value="ABC School" style="display: none;">
                                </div>
                            </div>
                        </div>

                        <!-- Emergency Contact -->
                        <div class="card profile-section-card emergency-card">
                            <div class="profile-section-header">
                                <h3 class="profile-section-title">
                                    <span class="material-symbols-outlined">emergency</span>
                                    Emergency Contact
                                </h3>
                                <button class="btn-header-toggle" id="emergencyToggleBtn">
                                    <span class="material-symbols-outlined" id="emergencyToggleIcon">edit</span>
                                    <span id="emergencyToggleText">Edit</span>
                                </button>
                            </div>
                            <div class="profile-info-grid">
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Contact Name</label>
                                    <p class="profile-info-value editable-field" data-field="emergencyName">Vivek P</p>
                                    <input type="text" class="profile-info-input" data-field="emergencyName" value="Vivek P" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Relationship</label>
                                    <p class="profile-info-value editable-field" data-field="emergencyRelation">Friend</p>
                                    <input type="text" class="profile-info-input" data-field="emergencyRelation" value="Friend" style="display: none;">
                                </div>
                                <div class="profile-info-item">
                                    <label class="profile-info-label">Phone Number</label>
                                    <p class="profile-info-value emergency editable-field" data-field="emergencyPhone">+91 98765 99999</p>
                                    <input type="tel" class="profile-info-input" data-field="emergencyPhone" value="+91 98765 99999" style="display: none;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load Sidebar and Header Components
            Promise.all([
                fetch('sidebar.html').then(response => response.text()),
                fetch('header.html').then(response => response.text())
            ]).then(([sidebarHTML, headerHTML]) => {
                document.getElementById('sidebar-container').innerHTML = sidebarHTML;
                document.getElementById('header-container').innerHTML = headerHTML;

                // Use setTimeout to ensure DOM has parsed the inserted HTML
                setTimeout(() => {
                    initializeSidebar();
                    // Call header initialization directly instead of relying on DOMContentLoaded
                    if (typeof initializeHeader === 'function') {
                        initializeHeader();
                    }

                    // Mark containers as loaded to make them visible with smooth transition
                    document.getElementById('sidebar-container').classList.add('loaded');
                    document.getElementById('header-container').classList.add('loaded');
                }, 0);
            });

            // Initialize all event listeners
            initializeProfileEvents();
        });

        function initializeSidebar() {
            const menuToggle = document.getElementById('menuToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            function toggleSidebar() {
                if (window.innerWidth >= 1024) {
                    sidebar.classList.toggle('collapsed');
                } else {
                    sidebar.classList.add('active');
                    sidebarOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            function closeSidebarFunc() {
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            menuToggle.addEventListener('click', toggleSidebar);
            closeSidebar.addEventListener('click', closeSidebarFunc);
            sidebarOverlay.addEventListener('click', closeSidebarFunc);

            const sidebarLinks = sidebar.querySelectorAll('a');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 1024) {
                        closeSidebarFunc();
                    }
                });
            });

            window.addEventListener('resize', () => {
                if (window.innerWidth >= 1024) {
                    closeSidebarFunc();
                } else {
                    sidebar.classList.remove('collapsed');
                }
            });

            setActiveLink();
        }

        function setActiveLink() {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = {
                'student-dashboard.html': 'nav-dashboard',
                'attendance.html': 'nav-attendance',
                'lms.html': 'nav-lms',
                'leaderboard.html': 'nav-leaderboard',
                'assessment.html': 'nav-assessment',
                'reports.html': 'nav-reports',
                'badges.html': 'nav-badges',
                'event-calendar.html': 'nav-event-calendar',
                'newsletter.html': 'nav-newsletter',
                'announcements.html': 'nav-announcements'
            };

            const sidebar = document.getElementById('sidebar');
            const sidebarLinks = sidebar.querySelectorAll('a');

            sidebarLinks.forEach(link => link.classList.remove('active'));

            if (navLinks[currentPage]) {
                const activeLink = document.getElementById(navLinks[currentPage]);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            }
        }

        // Validation functions
        function validateName(name) {
            if (!name || name.trim().length === 0) {
                return { valid: false, message: 'Name cannot be empty' };
            }
            if (name.trim().length < 2) {
                return { valid: false, message: 'Name must be at least 2 characters long' };
            }
            if (!/^[a-zA-Z\s.]+$/.test(name)) {
                return { valid: false, message: 'Name can only contain letters, spaces, and periods' };
            }
            return { valid: true };
        }

        function validateEmail(email) {
            if (!email || email.trim().length === 0) {
                return { valid: false, message: 'Email cannot be empty' };
            }
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                return { valid: false, message: 'Please enter a valid email address' };
            }
            return { valid: true };
        }

        function validatePhone(phone) {
            if (!phone || phone.trim().length === 0) {
                return { valid: false, message: 'Phone number cannot be empty' };
            }
            // Indian phone number format: +91 followed by 10 digits
            const phoneRegex = /^(\+91[\s]?)?[6-9]\d{4}[\s]?\d{5}$/;
            if (!phoneRegex.test(phone.replace(/\s/g, ''))) {
                return { valid: false, message: 'Please enter a valid Indian phone number (10 digits starting with 6-9)' };
            }
            return { valid: true };
        }

        function validateDate(date) {
            if (!date || date.trim().length === 0) {
                return { valid: false, message: 'Date cannot be empty' };
            }
            // Allow various date formats
            return { valid: true };
        }

        function validateGender(gender) {
            if (!gender || gender.trim().length === 0) {
                return { valid: false, message: 'Gender cannot be empty' };
            }
            const validGenders = ['male', 'female', 'other'];
            if (!validGenders.includes(gender.toLowerCase())) {
                return { valid: false, message: 'Gender must be Male, Female, or Other' };
            }
            return { valid: true };
        }

        function validateBloodGroup(bloodGroup) {
            if (!bloodGroup || bloodGroup.trim().length === 0) {
                return { valid: false, message: 'Blood group cannot be empty' };
            }
            const validBloodGroups = ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'];
            if (!validBloodGroups.includes(bloodGroup.toUpperCase())) {
                return { valid: false, message: 'Please enter a valid blood group (A+, A-, B+, B-, AB+, AB-, O+, O-)' };
            }
            return { valid: true };
        }

        function validateAddress(address) {
            if (!address || address.trim().length === 0) {
                return { valid: false, message: 'Address cannot be empty' };
            }
            if (address.trim().length < 10) {
                return { valid: false, message: 'Address must be at least 10 characters long' };
            }
            return { valid: true };
        }

        function validateOccupation(occupation) {
            if (!occupation || occupation.trim().length === 0) {
                return { valid: false, message: 'Occupation cannot be empty' };
            }
            if (!/^[a-zA-Z\s]+$/.test(occupation)) {
                return { valid: false, message: 'Occupation can only contain letters and spaces' };
            }
            return { valid: true };
        }

        function validateText(text, fieldName) {
            if (!text || text.trim().length === 0) {
                return { valid: false, message: `${fieldName} cannot be empty` };
            }
            return { valid: true };
        }

        function validateField(fieldName, value) {
            switch(fieldName) {
                case 'fullName':
                case 'fatherName':
                case 'motherName':
                case 'emergencyName':
                    return validateName(value);
                case 'email':
                    return validateEmail(value);
                case 'phone':
                case 'fatherPhone':
                case 'motherPhone':
                case 'emergencyPhone':
                    return validatePhone(value);
                case 'dob':
                    return validateDate(value);
                case 'gender':
                    return validateGender(value);
                case 'bloodGroup':
                    return validateBloodGroup(value);
                case 'address':
                    return validateAddress(value);
                case 'fatherOccupation':
                case 'motherOccupation':
                    return validateOccupation(value);
                case 'nationality':
                case 'religion':
                case 'category':
                case 'previousSchool':
                case 'emergencyRelation':
                    return validateText(value, fieldName.replace(/([A-Z])/g, ' $1').trim());
                default:
                    return { valid: true };
            }
        }

        // Helper function to show/hide error message
        function showError(inputElem, message) {
            // Remove existing error message if any
            const existingError = inputElem.parentElement.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }

            // Add error class to input
            inputElem.classList.add('error');

            // Create and append error message
            const errorSpan = document.createElement('span');
            errorSpan.className = 'error-message';
            errorSpan.textContent = message;
            inputElem.parentElement.appendChild(errorSpan);
        }

        function clearError(inputElem) {
            // Remove error class
            inputElem.classList.remove('error');

            // Remove error message
            const errorMessage = inputElem.parentElement.querySelector('.error-message');
            if (errorMessage) {
                errorMessage.remove();
            }
        }

        // Helper function to format date for display
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
            return `${date.getDate()} ${months[date.getMonth()]}, ${date.getFullYear()}`;
        }

        // Helper function to initialize card toggle buttons with validation
        function initializeCardToggle(cardName, ...fieldNames) {
            const toggleBtn = document.getElementById(`${cardName}ToggleBtn`);
            const toggleIcon = document.getElementById(`${cardName}ToggleIcon`);
            const toggleText = document.getElementById(`${cardName}ToggleText`);

            if (!toggleBtn || !toggleIcon || !toggleText) return;

            let isEditing = false;

            toggleBtn.addEventListener('click', () => {
                if (!isEditing) {
                    // Switch to Save mode
                    toggleIcon.textContent = 'check';
                    toggleText.textContent = 'Save';
                    toggleBtn.style.background = 'var(--green-600)';
                    toggleBtn.style.borderColor = '#16a34a';

                    // Show input fields for all specified fields
                    fieldNames.forEach(fieldName => {
                        const valueElem = document.querySelector(`[data-field="${fieldName}"].profile-info-value`);
                        const inputElem = document.querySelector(`[data-field="${fieldName}"].profile-info-input`);

                        if (valueElem && inputElem) {
                            // Set current value to input/select
                            if (inputElem.tagName === 'SELECT') {
                                inputElem.value = valueElem.textContent.trim();
                            }

                            valueElem.style.display = 'none';
                            inputElem.style.display = 'block';
                            // Clear any existing errors
                            clearError(inputElem);
                        }
                    });

                    isEditing = true;
                } else {
                    // Validate all fields before saving
                    let allValid = true;

                    fieldNames.forEach(fieldName => {
                        const inputElem = document.querySelector(`[data-field="${fieldName}"].profile-info-input`);
                        if (inputElem) {
                            const validation = validateField(fieldName, inputElem.value);
                            if (!validation.valid) {
                                allValid = false;
                                showError(inputElem, validation.message);
                            } else {
                                clearError(inputElem);
                            }
                        }
                    });

                    if (!allValid) {
                        return;
                    }

                    // Switch to Edit mode
                    toggleIcon.textContent = 'edit';
                    toggleText.textContent = 'Edit';
                    toggleBtn.style.background = '';
                    toggleBtn.style.borderColor = '';

                    // Save values and hide inputs
                    fieldNames.forEach(fieldName => {
                        const valueElem = document.querySelector(`[data-field="${fieldName}"].profile-info-value`);
                        const inputElem = document.querySelector(`[data-field="${fieldName}"].profile-info-input`);

                        if (valueElem && inputElem) {
                            // Format the value for display
                            if (inputElem.type === 'date') {
                                valueElem.textContent = formatDate(inputElem.value);
                            } else {
                                valueElem.textContent = inputElem.value;
                            }
                            valueElem.style.display = 'block';
                            inputElem.style.display = 'none';
                            clearError(inputElem);
                        }
                    });

                    isEditing = false;
                }
            });
        }

        // Initialize all profile-specific event listeners
        function initializeProfileEvents() {
            // Profile avatar upload
            const profileAvatarWrapper = document.getElementById('profileAvatarWrapper');
            const profileAvatarInput = document.getElementById('profileAvatarInput');
            const profileAvatar = document.getElementById('profileAvatar');

            if (profileAvatarWrapper && profileAvatarInput && profileAvatar) {
                profileAvatarWrapper.addEventListener('click', () => {
                    profileAvatarInput.click();
                });

                profileAvatarInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            profileAvatar.src = e.target.result;
                            // Update all instances of user avatar
                            document.querySelectorAll('.user-avatar, .dropdown-avatar').forEach(img => {
                                img.src = e.target.result;
                            });
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Header card edit/save toggle functionality
            const headerToggleBtn = document.getElementById('headerToggleBtn');
            const headerToggleIcon = document.getElementById('headerToggleIcon');
            const headerToggleText = document.getElementById('headerToggleText');

            if (headerToggleBtn && headerToggleIcon && headerToggleText) {
                let isHeaderEditing = false;

                headerToggleBtn.addEventListener('click', () => {
                    const headerName = document.getElementById('headerName');
                    const headerNameInput = document.getElementById('headerNameInput');
                    const headerEmail = document.getElementById('headerEmail');
                    const headerEmailInput = document.getElementById('headerEmailInput');
                    const headerPhone = document.getElementById('headerPhone');
                    const headerPhoneInput = document.getElementById('headerPhoneInput');

                    if (!isHeaderEditing) {
                        // Switch to Save mode
                        headerToggleIcon.textContent = 'check';
                        headerToggleText.textContent = 'Save';
                        headerToggleBtn.style.background = 'var(--green-600)';
                        headerToggleBtn.style.borderColor = '#16a34a';

                        // Show input fields
                        if (headerName && headerNameInput) {
                            headerName.style.display = 'none';
                            headerNameInput.style.display = 'block';
                            clearError(headerNameInput);
                        }
                        if (headerEmail && headerEmailInput) {
                            headerEmail.style.display = 'none';
                            headerEmailInput.style.display = 'block';
                            clearError(headerEmailInput);
                        }
                        if (headerPhone && headerPhoneInput) {
                            headerPhone.style.display = 'none';
                            headerPhoneInput.style.display = 'block';
                            clearError(headerPhoneInput);
                        }

                        isHeaderEditing = true;
                    } else {
                        // Validate fields before saving
                        let allValid = true;

                        // Validate name
                        const nameValidation = validateName(headerNameInput.value);
                        if (!nameValidation.valid) {
                            allValid = false;
                            showError(headerNameInput, nameValidation.message);
                        } else {
                            clearError(headerNameInput);
                        }

                        // Validate email
                        const emailValidation = validateEmail(headerEmailInput.value);
                        if (!emailValidation.valid) {
                            allValid = false;
                            showError(headerEmailInput, emailValidation.message);
                        } else {
                            clearError(headerEmailInput);
                        }

                        // Validate phone
                        const phoneValidation = validatePhone(headerPhoneInput.value);
                        if (!phoneValidation.valid) {
                            allValid = false;
                            showError(headerPhoneInput, phoneValidation.message);
                        } else {
                            clearError(headerPhoneInput);
                        }

                        if (!allValid) {
                            return;
                        }

                        // Switch to Edit mode
                        headerToggleIcon.textContent = 'edit';
                        headerToggleText.textContent = 'Edit';
                        headerToggleBtn.style.background = '';
                        headerToggleBtn.style.borderColor = '';

                        // Save values and hide inputs
                        if (headerName && headerNameInput) {
                            headerName.textContent = headerNameInput.value;
                            headerName.style.display = 'block';
                            headerNameInput.style.display = 'none';
                            clearError(headerNameInput);
                        }
                        if (headerEmail && headerEmailInput) {
                            headerEmail.textContent = headerEmailInput.value;
                            headerEmail.style.display = 'block';
                            headerEmailInput.style.display = 'none';
                            clearError(headerEmailInput);
                        }
                        if (headerPhone && headerPhoneInput) {
                            headerPhone.textContent = headerPhoneInput.value;
                            headerPhone.style.display = 'block';
                            headerPhoneInput.style.display = 'none';
                            clearError(headerPhoneInput);
                        }

                        isHeaderEditing = false;
                    }
                });
            }

            // Personal Information card toggle functionality
            initializeCardToggle('personal', 'fullName', 'dob', 'gender', 'bloodGroup');

            // Contact Information card toggle functionality
            initializeCardToggle('contact', 'email', 'phone', 'address');

            // Parent/Guardian Information card toggle functionality
            initializeCardToggle('parent', 'fatherName', 'fatherOccupation', 'fatherPhone', 'motherName', 'motherOccupation', 'motherPhone');

            // Additional Information card toggle functionality
            initializeCardToggle('additional', 'nationality', 'religion', 'category', 'previousSchool');

            // Emergency Contact card toggle functionality
            initializeCardToggle('emergency', 'emergencyName', 'emergencyRelation', 'emergencyPhone');

            // Edit mode functionality for all sections
            const editModeBtn = document.getElementById('editModeBtn');
            const editBtnText = document.getElementById('editBtnText');

            if (editModeBtn && editBtnText) {
                let isEditMode = false;

                editModeBtn.addEventListener('click', () => {
                    isEditMode = !isEditMode;

                    if (isEditMode) {
                        // Enable edit mode
                        editBtnText.textContent = 'Save Changes';

                        // Show input fields and hide text
                        document.querySelectorAll('.editable-field').forEach(field => {
                            field.style.display = 'none';
                            const input = field.nextElementSibling;
                            if (input && input.classList.contains('profile-info-input')) {
                                input.style.display = 'block';
                            }
                        });
                    } else {
                        // Save changes and disable edit mode
                        editBtnText.textContent = 'Edit Profile';
                        editModeBtn.style.background = '';

                        // Update text from inputs and hide inputs
                        document.querySelectorAll('.editable-field').forEach(field => {
                            const input = field.nextElementSibling;
                            if (input && input.classList.contains('profile-info-input')) {
                                field.textContent = input.value;
                                input.style.display = 'none';
                            }
                            field.style.display = 'block';
                        });
                    }
                });
            }
        }
    </script>
</body>

</html>
