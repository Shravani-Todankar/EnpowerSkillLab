<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Account Settings - Enpower Skill Lab</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="student-dashboard.css">
    <link rel="stylesheet" href="account-settings.css">
    <!-- Header JS -->
    <script src="header.js"></script>

    <style>
        /* Prevent FOUC - hide containers until loaded */
        #sidebar-container:empty,
        #header-container:empty {
            opacity: 0;
            visibility: hidden;
        }

        #sidebar-container.loaded,
        #header-container.loaded {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.2s ease-in;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Include Sidebar Component -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Include Header Component -->
            <div id="header-container"></div>

            <!-- Account Settings Page Content -->
            <div class="settings-page">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-header-content">
                        <h1 class="page-title">
                            <span class="material-symbols-outlined page-title-icon">settings</span>
                            Account Settings
                        </h1>
                        <p class="page-subtitle">Manage your account security and login credentials</p>
                    </div>
                </div>

                <!-- Settings Content -->
                <div class="settings-content">
                    <!-- Change Password Card -->
                    <div class="card settings-card">
                        <div class="settings-card-header">
                            <div class="settings-card-title-wrapper">
                                <h3 class="settings-card-title">
                                    <span class="material-symbols-outlined">lock</span>
                                    Change Password
                                </h3>
                                <p class="settings-card-subtitle">Update your password to keep your account secure</p>
                            </div>
                        </div>
                        <div class="settings-card-body">
                            <form id="changePasswordForm">
                                <div class="form-group">
                                    <label class="form-label">Current Password</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="currentPassword" class="form-input" placeholder="Enter current password" required>
                                        <button type="button" class="toggle-password-btn" data-target="currentPassword">
                                            <span class="material-symbols-outlined">visibility</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">New Password</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="newPassword" class="form-input" placeholder="Enter new password" required>
                                        <button type="button" class="toggle-password-btn" data-target="newPassword">
                                            <span class="material-symbols-outlined">visibility</span>
                                        </button>
                                    </div>
                                    <div class="password-strength" id="passwordStrength">
                                        <div class="password-strength-bar">
                                            <div class="password-strength-fill" id="passwordStrengthFill"></div>
                                        </div>
                                        <span class="password-strength-text" id="passwordStrengthText">Password strength</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confirm New Password</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password" required>
                                        <button type="button" class="toggle-password-btn" data-target="confirmPassword">
                                            <span class="material-symbols-outlined">visibility</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="password-requirements">
                                    <p class="requirements-title">Password must contain:</p>
                                    <ul class="requirements-list">
                                        <li id="req-length"><span class="material-symbols-outlined">cancel</span>At least 8 characters</li>
                                        <li id="req-uppercase"><span class="material-symbols-outlined">cancel</span>One uppercase letter</li>
                                        <li id="req-lowercase"><span class="material-symbols-outlined">cancel</span>One lowercase letter</li>
                                        <li id="req-number"><span class="material-symbols-outlined">cancel</span>One number</li>
                                        <li id="req-special"><span class="material-symbols-outlined">cancel</span>One special character</li>
                                    </ul>
                                </div>
                                <button type="submit" class="btn-primary">
                                    <span class="material-symbols-outlined">check_circle</span>
                                    Update Password
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Change Email Card -->
                    <div class="card settings-card">
                        <div class="settings-card-header">
                            <div class="settings-card-title-wrapper">
                                <h3 class="settings-card-title">
                                    <span class="material-symbols-outlined">email</span>
                                    Change Email Address
                                </h3>
                                <p class="settings-card-subtitle">Update the email address associated with your account</p>
                            </div>
                        </div>
                        <div class="settings-card-body">
                            <div class="current-info-box">
                                <div class="current-info-label">Current Email</div>
                                <div class="current-info-value">kunal@student.com</div>
                            </div>
                            <form id="changeEmailForm">
                                <div class="form-group">
                                    <label class="form-label">New Email Address</label>
                                    <input type="email" id="newEmail" class="form-input" placeholder="Enter new email address" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confirm Password</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="emailChangePassword" class="form-input" placeholder="Enter your password to confirm" required>
                                        <button type="button" class="toggle-password-btn" data-target="emailChangePassword">
                                            <span class="material-symbols-outlined">visibility</span>
                                        </button>
                                    </div>
                                </div>
                                <button type="submit" class="btn-primary">
                                    <span class="material-symbols-outlined">check_circle</span>
                                    Update Email
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Change Username Card -->
                    <div class="card settings-card">
                        <div class="settings-card-header">
                            <div class="settings-card-title-wrapper">
                                <h3 class="settings-card-title">
                                    <span class="material-symbols-outlined">person</span>
                                    Change Username
                                </h3>
                                <p class="settings-card-subtitle">Update your username for login</p>
                            </div>
                        </div>
                        <div class="settings-card-body">
                            <div class="current-info-box">
                                <div class="current-info-label">Current Username</div>
                                <div class="current-info-value">kunal</div>
                            </div>
                            <form id="changeUsernameForm">
                                <div class="form-group">
                                    <label class="form-label">New Username</label>
                                    <input type="text" id="newUsername" class="form-input" placeholder="Enter new username" required>
                                    <span class="form-hint">Username must be 3-20 characters long and can only contain letters, numbers, and underscores</span>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confirm Password</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="usernameChangePassword" class="form-input" placeholder="Enter your password to confirm" required>
                                        <button type="button" class="toggle-password-btn" data-target="usernameChangePassword">
                                            <span class="material-symbols-outlined">visibility</span>
                                        </button>
                                    </div>
                                </div>
                                <button type="submit" class="btn-primary">
                                    <span class="material-symbols-outlined">check_circle</span>
                                    Update Username
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Two-Factor Authentication Card -->
                    <div class="card settings-card">
                        <div class="settings-card-header">
                            <div class="settings-card-title-wrapper">
                                <h3 class="settings-card-title">
                                    <span class="material-symbols-outlined">shield</span>
                                    Two-Factor Authentication
                                </h3>
                                <p class="settings-card-subtitle">Add an extra layer of security to your account</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="twoFactorToggle" class="toggle-checkbox">
                                <label for="twoFactorToggle" class="toggle-label"></label>
                            </div>
                        </div>
                        <div class="settings-card-body">
                            <div class="info-box">
                                <span class="material-symbols-outlined">info</span>
                                <p>Two-factor authentication adds an additional layer of security to your account by requiring more than just a password to log in.</p>
                            </div>
                            <div id="twoFactorSetup" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">Phone Number for SMS</label>
                                    <input type="tel" id="twoFactorPhone" class="form-input" placeholder="+91 98765 43210">
                                </div>
                                <button type="button" class="btn-secondary" id="setupTwoFactorBtn">
                                    <span class="material-symbols-outlined">send</span>
                                    Send Verification Code
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Session Management Card -->
                    <div class="card settings-card">
                        <div class="settings-card-header">
                            <div class="settings-card-title-wrapper">
                                <h3 class="settings-card-title">
                                    <span class="material-symbols-outlined">devices</span>
                                    Active Sessions
                                </h3>
                                <p class="settings-card-subtitle">Manage devices where you're currently logged in</p>
                            </div>
                        </div>
                        <div class="settings-card-body">
                            <div class="session-item current-session">
                                <div class="session-icon">
                                    <span class="material-symbols-outlined">computer</span>
                                </div>
                                <div class="session-details">
                                    <div class="session-device">MacBook Pro - Chrome</div>
                                    <div class="session-info">Mumbai, India • Last active: Now</div>
                                    <span class="session-badge">Current Session</span>
                                </div>
                            </div>
                            <div class="session-item">
                                <div class="session-icon">
                                    <span class="material-symbols-outlined">phone_iphone</span>
                                </div>
                                <div class="session-details">
                                    <div class="session-device">iPhone 12 - Safari</div>
                                    <div class="session-info">Mumbai, India • Last active: 2 hours ago</div>
                                </div>
                                <button class="btn-revoke">
                                    <span class="material-symbols-outlined">close</span>
                                    Revoke
                                </button>
                            </div>
                            <div class="session-item">
                                <div class="session-icon">
                                    <span class="material-symbols-outlined">tablet</span>
                                </div>
                                <div class="session-details">
                                    <div class="session-device">iPad Air - Safari</div>
                                    <div class="session-info">Delhi, India • Last active: 1 day ago</div>
                                </div>
                                <button class="btn-revoke">
                                    <span class="material-symbols-outlined">close</span>
                                    Revoke
                                </button>
                            </div>
                            <button type="button" class="btn-danger-outline" id="revokeAllBtn">
                                <span class="material-symbols-outlined">logout</span>
                                Sign Out All Other Sessions
                            </button>
                        </div>
                    </div>

                    <!-- Danger Zone Card -->
                    <div class="card settings-card danger-card">
                        <div class="settings-card-header">
                            <div class="settings-card-title-wrapper">
                                <h3 class="settings-card-title">
                                    <span class="material-symbols-outlined">warning</span>
                                    Danger Zone
                                </h3>
                                <p class="settings-card-subtitle">Irreversible and destructive actions</p>
                            </div>
                        </div>
                        <div class="settings-card-body">
                            <div class="danger-action">
                                <div class="danger-action-info">
                                    <h4 class="danger-action-title">Deactivate Account</h4>
                                    <p class="danger-action-description">Temporarily disable your account. You can reactivate it anytime by logging in.</p>
                                </div>
                                <button type="button" class="btn-danger-outline" id="deactivateAccountBtn">
                                    Deactivate
                                </button>
                            </div>
                            <div class="danger-divider"></div>
                            <div class="danger-action">
                                <div class="danger-action-info">
                                    <h4 class="danger-action-title">Delete Account</h4>
                                    <p class="danger-action-description">Permanently delete your account and all associated data. This action cannot be undone.</p>
                                </div>
                                <button type="button" class="btn-danger" id="deleteAccountBtn">
                                    Delete Account
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Load Sidebar and Header Components
        document.addEventListener('DOMContentLoaded', function() {
            Promise.all([
                fetch('sidebar.html').then(response => response.text()),
                fetch('header.html').then(response => response.text())
            ]).then(([sidebarHTML, headerHTML]) => {
                document.getElementById('sidebar-container').innerHTML = sidebarHTML;
                document.getElementById('header-container').innerHTML = headerHTML;

                // Use setTimeout to ensure DOM has parsed the inserted HTML
                setTimeout(() => {
                    initializeSidebar();
                    // Call header initialization directly instead of relying on DOMContentLoaded
                    if (typeof initializeHeader === 'function') {
                        initializeHeader();
                    }

                    // Mark containers as loaded to make them visible with smooth transition
                    document.getElementById('sidebar-container').classList.add('loaded');
                    document.getElementById('header-container').classList.add('loaded');

                    initializeAccountSettings();
                }, 0);
            });
        });

        function initializeSidebar() {
            const menuToggle = document.getElementById('menuToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            function toggleSidebar() {
                if (window.innerWidth >= 1024) {
                    sidebar.classList.toggle('collapsed');
                } else {
                    sidebar.classList.add('active');
                    sidebarOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            function closeSidebarFunc() {
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            menuToggle.addEventListener('click', toggleSidebar);
            closeSidebar.addEventListener('click', closeSidebarFunc);
            sidebarOverlay.addEventListener('click', closeSidebarFunc);

            const sidebarLinks = sidebar.querySelectorAll('a');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 1024) {
                        closeSidebarFunc();
                    }
                });
            });

            window.addEventListener('resize', () => {
                if (window.innerWidth >= 1024) {
                    closeSidebarFunc();
                } else {
                    sidebar.classList.remove('collapsed');
                }
            });
        }

        function initializeAccountSettings() {
            // Password visibility toggles
            document.querySelectorAll('.toggle-password-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const input = document.getElementById(targetId);
                    const icon = this.querySelector('.material-symbols-outlined');

                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.textContent = 'visibility_off';
                    } else {
                        input.type = 'password';
                        icon.textContent = 'visibility';
                    }
                });
            });

            // Password strength checker
            const newPasswordInput = document.getElementById('newPassword');
            if (newPasswordInput) {
                newPasswordInput.addEventListener('input', checkPasswordStrength);
            }

            // Password requirements checker
            const passwordInput = document.getElementById('newPassword');
            if (passwordInput) {
                passwordInput.addEventListener('input', checkPasswordRequirements);
            }

            // Change Password Form
            const changePasswordForm = document.getElementById('changePasswordForm');
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const currentPassword = document.getElementById('currentPassword').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;

                    if (newPassword !== confirmPassword) {
                        alert('New passwords do not match!');
                        return;
                    }

                    if (!validatePassword(newPassword)) {
                        alert('Password does not meet the requirements!');
                        return;
                    }

                    // Simulate password change
                    alert('Password changed successfully!');
                    this.reset();
                    resetPasswordStrength();
                });
            }

            // Change Email Form
            const changeEmailForm = document.getElementById('changeEmailForm');
            if (changeEmailForm) {
                changeEmailForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const newEmail = document.getElementById('newEmail').value;

                    alert(`Verification email sent to ${newEmail}. Please check your inbox.`);
                    this.reset();
                });
            }

            // Change Username Form
            const changeUsernameForm = document.getElementById('changeUsernameForm');
            if (changeUsernameForm) {
                changeUsernameForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const newUsername = document.getElementById('newUsername').value;

                    if (!validateUsername(newUsername)) {
                        alert('Username must be 3-20 characters long and can only contain letters, numbers, and underscores');
                        return;
                    }

                    alert('Username changed successfully!');
                    document.querySelector('.current-info-value').textContent = newUsername;
                    this.reset();
                });
            }

            // Two-Factor Authentication Toggle
            const twoFactorToggle = document.getElementById('twoFactorToggle');
            const twoFactorSetup = document.getElementById('twoFactorSetup');
            if (twoFactorToggle) {
                twoFactorToggle.addEventListener('change', function() {
                    if (this.checked) {
                        twoFactorSetup.style.display = 'block';
                    } else {
                        twoFactorSetup.style.display = 'none';
                        if (confirm('Are you sure you want to disable two-factor authentication?')) {
                            alert('Two-factor authentication disabled');
                        } else {
                            this.checked = true;
                        }
                    }
                });
            }

            // Setup Two-Factor Button
            const setupTwoFactorBtn = document.getElementById('setupTwoFactorBtn');
            if (setupTwoFactorBtn) {
                setupTwoFactorBtn.addEventListener('click', function() {
                    const phone = document.getElementById('twoFactorPhone').value;
                    if (phone) {
                        alert(`Verification code sent to ${phone}`);
                    } else {
                        alert('Please enter a phone number');
                    }
                });
            }

            // Revoke Session Buttons
            document.querySelectorAll('.btn-revoke').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to revoke this session?')) {
                        this.closest('.session-item').remove();
                        alert('Session revoked successfully');
                    }
                });
            });

            // Revoke All Sessions
            const revokeAllBtn = document.getElementById('revokeAllBtn');
            if (revokeAllBtn) {
                revokeAllBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to sign out all other sessions?')) {
                        document.querySelectorAll('.session-item:not(.current-session)').forEach(item => {
                            item.remove();
                        });
                        alert('All other sessions have been signed out');
                    }
                });
            }

            // Deactivate Account
            const deactivateAccountBtn = document.getElementById('deactivateAccountBtn');
            if (deactivateAccountBtn) {
                deactivateAccountBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to deactivate your account? You can reactivate it anytime by logging in.')) {
                        alert('Account deactivation initiated. You will receive a confirmation email.');
                    }
                });
            }

            // Delete Account
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');
            if (deleteAccountBtn) {
                deleteAccountBtn.addEventListener('click', function() {
                    const confirmation = prompt('This action is permanent and cannot be undone. Type "DELETE" to confirm:');
                    if (confirmation === 'DELETE') {
                        alert('Account deletion initiated. You will receive a final confirmation email.');
                    } else if (confirmation !== null) {
                        alert('Account deletion cancelled. Please type "DELETE" exactly to confirm.');
                    }
                });
            }
        }

        // Password strength checker
        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthFill = document.getElementById('passwordStrengthFill');
            const strengthText = document.getElementById('passwordStrengthText');

            let strength = 0;

            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[^a-zA-Z0-9]/.test(password)) strength++;

            const percentage = (strength / 5) * 100;
            strengthFill.style.width = percentage + '%';

            if (strength === 0) {
                strengthFill.className = 'password-strength-fill';
                strengthText.textContent = 'Password strength';
            } else if (strength <= 2) {
                strengthFill.className = 'password-strength-fill weak';
                strengthText.textContent = 'Weak password';
            } else if (strength <= 3) {
                strengthFill.className = 'password-strength-fill medium';
                strengthText.textContent = 'Medium password';
            } else if (strength <= 4) {
                strengthFill.className = 'password-strength-fill good';
                strengthText.textContent = 'Good password';
            } else {
                strengthFill.className = 'password-strength-fill strong';
                strengthText.textContent = 'Strong password';
            }
        }

        function resetPasswordStrength() {
            const strengthFill = document.getElementById('passwordStrengthFill');
            const strengthText = document.getElementById('passwordStrengthText');
            strengthFill.style.width = '0%';
            strengthFill.className = 'password-strength-fill';
            strengthText.textContent = 'Password strength';
        }

        // Password requirements checker
        function checkPasswordRequirements() {
            const password = document.getElementById('newPassword').value;

            updateRequirement('req-length', password.length >= 8);
            updateRequirement('req-uppercase', /[A-Z]/.test(password));
            updateRequirement('req-lowercase', /[a-z]/.test(password));
            updateRequirement('req-number', /\d/.test(password));
            updateRequirement('req-special', /[^a-zA-Z0-9]/.test(password));
        }

        function updateRequirement(id, met) {
            const element = document.getElementById(id);
            const icon = element.querySelector('.material-symbols-outlined');

            if (met) {
                element.classList.add('met');
                icon.textContent = 'check_circle';
            } else {
                element.classList.remove('met');
                icon.textContent = 'cancel';
            }
        }

        // Validate password
        function validatePassword(password) {
            return password.length >= 8 &&
                   /[A-Z]/.test(password) &&
                   /[a-z]/.test(password) &&
                   /\d/.test(password) &&
                   /[^a-zA-Z0-9]/.test(password);
        }

        // Validate username
        function validateUsername(username) {
            return /^[a-zA-Z0-9_]{3,20}$/.test(username);
        }
    </script>
</body>

</html>
