<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Add Class - Super Admin</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />

    <!-- Sidebar JS -->
    <script src="sidebar.js"></script>
    <!-- Header JS -->
    <script src="header.js"></script>

    <style>
        /* Prevent FOUC - hide containers until loaded */
        #sidebar-container:empty,
        #header-container:empty {
            opacity: 0;
            visibility: hidden;
        }

        #sidebar-container.loaded,
        #header-container.loaded {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.2s ease-in;
        }

        :root {
            --primary: #5b1f6f;
            --background-light: #f7f6f8;
            --background-dark: #1c131f;
            --text-main: #161217;
            --text-subtle: #7c6882;
            --border-color: #e2dde4;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-light);
            color: var(--text-main);
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .content-wrapper {
            flex: 1;
            padding: 0px 15px 0px 15px;
        }

        /* Page Styles */
        /* .page-header {
            margin-bottom: 2rem;
        } */

        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            font-size: 0.875rem;
            color: var(--text-subtle);
        }

        /* Button Styles */
        .btn-primary-custom {
            background-color: var(--primary);
            color: white;
            border: none;
            font-weight: 600;
            border-radius: 0.5rem;
            padding: 0.625rem 1.25rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .btn-primary-custom:hover {
            background-color: #4a195b;
            color: white;
        }

        .btn-secondary-custom {
            background-color: white;
            color: var(--text-main);
            border: 1px solid var(--border-color);
            font-weight: 600;
            border-radius: 0.5rem;
            padding: 0.625rem 1.25rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .btn-secondary-custom:hover {
            background-color: #f7f6f8;
            color: var(--text-main);
            border-color: var(--text-subtle);
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }

        .card-header-custom {
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            background-color: #fafafa;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-header-custom .material-symbols-outlined {
            color: var(--primary);
            font-size: 20px;
        }

        .card-header-custom h3 {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-main);
            margin: 0;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Form Styles */
        .form-label-custom {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-label-custom .required {
            color: #dc3545;
            margin-left: 0.25rem;
        }

        .form-control-custom,
        .form-select-custom {
            background-color: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.625rem 0.75rem;
            font-size: 0.875rem;
            color: var(--text-main);
            width: 100%;
            transition: all 0.2s;
        }

        .form-control-custom:focus,
        .form-select-custom:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(91, 31, 111, 0.25);
            outline: none;
        }

        .form-control-custom:read-only {
            background-color: #f0f0f0;
            color: var(--text-subtle);
            cursor: not-allowed;
        }

        .input-with-icon {
            position: relative;
        }

        .input-icon-left {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-subtle);
            pointer-events: none;
        }

        .input-icon-right {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-subtle);
            pointer-events: none;
        }

        .form-control-with-icon-left {
            padding-left: 2.5rem;
        }

        .form-control-with-icon-right {
            padding-right: 2.5rem;
        }

        .form-text-custom {
            font-size: 0.75rem;
            color: var(--text-subtle);
            margin-top: 0.25rem;
        }

        /* Auto-generated section */
        .auto-generated-section {
            background-color: #fafafa;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.25rem;
        }

        .auto-generated-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }

        .auto-generated-badge .material-symbols-outlined {
            font-size: 16px;
        }

        .auto-field-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-subtle);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.375rem;
        }

        .auto-field-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-main);
            font-family: 'Poppins', sans-serif;
        }

        .auto-field-value.code {
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }

        /* Toggle Switch */
        .form-switch-custom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
        }

        .form-switch-custom .switch-label {
            display: flex;
            flex-direction: column;
        }

        .form-switch-custom .switch-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-main);
        }

        .form-switch-custom .switch-description {
            font-size: 0.75rem;
            color: var(--text-subtle);
        }

        .form-switch .form-check-input {
            width: 2.75rem;
        }

        .form-check-input {
            width: 2.75rem;
            height: 1.5rem;
            cursor: pointer;
            border: 2px solid #d1d5db;
            background-color: #e5e7eb;
        }

        .form-check-input:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .form-check-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(91, 31, 111, 0.25);
        }

        /* Gradient Card */
        .gradient-card {
            background: linear-gradient(135deg, var(--primary) 0%, #80588d 100%);
            border-radius: 12px;
            padding: 1.5rem;
            color: white;
            position: relative;
            overflow: hidden;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(91, 31, 111, 0.15);
        }

        .gradient-card::before,
        .gradient-card::after {
            content: '';
            position: absolute;
            width: 6rem;
            height: 6rem;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            filter: blur(40px);
        }

        .gradient-card::before {
            top: -2rem;
            right: -2rem;
        }

        .gradient-card::after {
            bottom: -2rem;
            left: -2rem;
        }

        .gradient-card-content {
            position: relative;
            z-index: 1;
        }

        .gradient-card-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .gradient-card-value {
            font-size: 3rem;
            font-weight: 900;
            line-height: 1;
            margin-bottom: 0.75rem;
        }

        .gradient-card-value span {
            font-size: 1.125rem;
            font-weight: 500;
            opacity: 0.8;
            margin-left: 0.5rem;
        }

        .gradient-card-description {
            font-size: 0.75rem;
            opacity: 0.75;
            line-height: 1.5;
        }

        /* School Search Dropdown */
        .school-search-container {
            position: relative;
        }

        .school-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            margin-top: 0.25rem;
            max-height: 250px;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .school-dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.875rem;
        }

        .school-dropdown-item:last-child {
            border-bottom: none;
        }

        .school-dropdown-item:hover {
            background-color: #f7f6f8;
        }

        .school-dropdown-item.selected {
            background-color: #f0e8f3;
            color: var(--primary);
            font-weight: 600;
        }

        .school-dropdown-item.no-results {
            padding: 1rem;
            text-align: center;
            color: var(--text-subtle);
            cursor: default;
        }

        .school-dropdown-item.no-results:hover {
            background-color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Header -->
            <div id="header-container"></div>

            <!-- Content -->
            <div class="content-wrapper">
                <main class="container-xl py-5" style="max-width: 1600px;">
                    <!-- Page Header -->
                    <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3 mb-1">
                        <div class="page-header">
                            <h1 class="page-title">Add Class</h1>
                            <p class="page-subtitle">Define new class structure and assign coaches.</p>
                        </div>
                        <div class="d-flex gap-3">
                            <button class="btn-secondary-custom" type="button" onclick="window.location.href='class-list.html'">
                                Cancel
                            </button>
                            <button class="btn-primary-custom" type="button">
                                <span class="material-symbols-outlined" style="font-size: 18px;">save</span>
                                Save Class
                            </button>
                        </div>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="row">
                        <!-- Left Column: Primary Details -->
                        <div class="col-lg-8">
                            <!-- Card 1: School Context -->
                            <div class="card">
                                <div class="card-header-custom">
                                    <span class="material-symbols-outlined">school</span>
                                    <h3>School & Academic Context</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <!-- School Selection with Search -->
                                        <div class="col-12">
                                            <label class="form-label-custom" for="school">
                                                School Name <span class="required">*</span>
                                            </label>
                                            <div class="input-with-icon school-search-container">
                                                <span class="material-symbols-outlined input-icon-left">search</span>
                                                <input
                                                    type="text"
                                                    class="form-control-custom form-control-with-icon-left"
                                                    id="school"
                                                    name="school"
                                                    placeholder="Search for a school..."
                                                    autocomplete="off"
                                                />
                                                <div class="school-dropdown" id="schoolDropdown" style="display: none;">
                                                    <!-- Dropdown items will be populated dynamically -->
                                                </div>
                                            </div>
                                        </div>

                                        <!-- City (Read Only) -->
                                        <div class="col-md-6">
                                            <label class="form-label-custom" for="city">City / Location</label>
                                            <div class="input-with-icon">
                                                <input class="form-control-custom form-control-with-icon-right" id="city" name="city" readonly type="text" value="Mumbai, India" />
                                                <span class="material-symbols-outlined input-icon-right" style="font-size: 18px;">lock</span>
                                            </div>
                                        </div>

                                        <!-- Academic Year -->
                                        <div class="col-md-6">
                                            <label class="form-label-custom" for="academic-year">
                                                Academic Year <span class="required">*</span>
                                            </label>
                                            <select class="form-select-custom" id="academic-year" name="academic-year">
                                                <option>2025-2026</option>
                                                <option>2024-2025</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Card 2: Class Details -->
                            <div class="card">
                                <div class="card-header-custom">
                                    <span class="material-symbols-outlined">meeting_room</span>
                                    <h3>Class Details</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3 mb-4">
                                        <!-- Grade -->
                                        <div class="col-md-6">
                                            <label class="form-label-custom" for="grade">
                                                Grade / Standard <span class="required">*</span>
                                            </label>
                                            <select class="form-select-custom" id="grade" name="grade">
                                                <option disabled hidden>Select Grade</option>
                                                <option>Standard 8</option>
                                                <option selected>Standard 9</option>
                                                <option>Standard 10</option>
                                            </select>
                                        </div>

                                        <!-- Division -->
                                        <div class="col-md-6">
                                            <label class="form-label-custom" for="division">
                                                Division <span class="required">*</span>
                                            </label>
                                            <input class="form-control-custom" id="division" name="division" placeholder="e.g. A, B, C" type="text" value="A" />
                                        </div>
                                    </div>

                                    <!-- Auto Generated Fields -->
                                    <div class="auto-generated-section">
                                        <div class="auto-generated-badge">
                                            <span class="material-symbols-outlined">auto_awesome</span>
                                            System Generated
                                        </div>
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <div class="auto-field-label">Class Name</div>
                                                <div class="auto-field-value">Std 9A</div>
                                                <div class="form-text-custom">Generated from Grade and Division</div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="auto-field-label">Class Code</div>
                                                <div class="auto-field-value code">CLS-2025-9A-001</div>
                                                <div class="form-text-custom">Unique identifier for this class</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Card 3: Coach Assignment -->
                            <div class="card">
                                <div class="card-header-custom">
                                    <span class="material-symbols-outlined">person_check</span>
                                    <h3>Thinking Coach Assignment</h3>
                                </div>
                                <div class="card-body">
                                    <label class="form-label-custom" for="coach">Assigned Coach</label>
                                    <p class="form-text-custom mb-3">Select the primary coach responsible for this class division.</p>
                                    <div class="input-with-icon">
                                        <span class="material-symbols-outlined input-icon-left">face</span>
                                        <select class="form-select-custom form-control-with-icon-left" id="coach" name="coach">
                                            <option>Select a Thinking Coach...</option>
                                            <option>Sarah Jenkins</option>
                                            <option>Michael Chen</option>
                                            <option>Priya Patel</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Meta & Status -->
                        <div class="col-lg-4">
                            <!-- Card 4: Status & Visibility -->
                            <div class="card">
                                <div class="card-header-custom">
                                    <span class="material-symbols-outlined">settings</span>
                                    <h3>Status & Visibility</h3>
                                </div>
                                <div class="card-body">
                                    <!-- Class Status -->
                                    <div class="form-switch-custom">
                                        <div class="switch-label">
                                            <span class="switch-title">Class Status</span>
                                            <span class="switch-description">Enable or disable this class</span>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="classStatus" checked>
                                        </div>
                                    </div>

                                    <hr style="border-color: var(--border-color); margin: 1rem 0;">

                                    <!-- Student Visibility -->
                                    <div class="form-switch-custom">
                                        <div class="switch-label">
                                            <span class="switch-title">Student Visibility</span>
                                            <span class="switch-description">Show to assigned students</span>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="studentVisibility" checked>
                                        </div>
                                    </div>

                                    <hr style="border-color: var(--border-color); margin: 1rem 0;">

                                    <!-- Parent Visibility -->
                                    <div class="form-switch-custom">
                                        <div class="switch-label">
                                            <span class="switch-title">Parent Visibility</span>
                                            <span class="switch-description">Show to connected parents</span>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="parentVisibility">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Card 5: Program Configuration -->
                            <div class="card">
                                <div class="card-header-custom">
                                    <span class="material-symbols-outlined">event_note</span>
                                    <h3>Program Configuration</h3>
                                </div>
                                <div class="card-body">
                                    <label class="form-label-custom" for="sessions">Number of Sessions</label>
                                    <p class="form-text-custom mb-3">Enter the total number of sessions for this class.</p>
                                    <input class="form-control-custom" id="sessions" name="sessions" type="number" min="1" max="100" placeholder="e.g. 48" value="48" />
                                </div>
                            </div>

                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Load sidebar
        fetch('sidebar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('sidebar-container').innerHTML = data;
                document.getElementById('sidebar-container').classList.add('loaded');
            })
            .catch(error => console.error('Error loading sidebar:', error));

        // Load header
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                document.getElementById('header-container').classList.add('loaded');
            })
            .catch(error => console.error('Error loading header:', error));

        /**
         * ========================================
         * ADD CLASS FORM FUNCTIONALITY
         * ========================================
         */
        document.addEventListener('DOMContentLoaded', function() {
            // Form Elements
            const schoolInput = document.getElementById('school');
            const schoolDropdown = document.getElementById('schoolDropdown');
            const cityInput = document.getElementById('city');
            const academicYearSelect = document.getElementById('academic-year');
            const gradeSelect = document.getElementById('grade');
            const divisionInput = document.getElementById('division');
            const coachSelect = document.getElementById('coach');
            const saveButton = document.querySelector('.btn-primary-custom');
            const cancelButton = document.querySelector('.btn-secondary-custom');

            // Auto-generated display elements
            const classNameDisplay = document.querySelector('.auto-field-value:not(.code)');
            const classCodeDisplay = document.querySelector('.auto-field-value.code');

            // Program configuration
            const sessionsInput = document.getElementById('sessions');

            // School data - list of available schools
            const schools = [
                'Greenwood International High',
                "St. Xavier's Academy",
                'Modern Public School',
                'Delhi Public School',
                'Ryan International School',
                'DAV Public School',
                'Kendriya Vidyalaya',
                'Maharishi Vidya Mandir',
                'Sardar Patel Vidyalaya',
                'Springdales School'
            ];

            // School and City Mapping
            const schoolCityMap = {
                'Greenwood International High': 'Mumbai, India',
                "St. Xavier's Academy": 'Delhi, India',
                'Modern Public School': 'Pune, India',
                'Delhi Public School': 'Delhi, India',
                'Ryan International School': 'Mumbai, India',
                'DAV Public School': 'Pune, India',
                'Kendriya Vidyalaya': 'Delhi, India',
                'Maharishi Vidya Mandir': 'Mumbai, India',
                'Sardar Patel Vidyalaya': 'Delhi, India',
                'Springdales School': 'Pune, India'
            };

            // Store selected school value
            let selectedSchool = '';

            /**
             * ========================================
             * UTILITY FUNCTIONS
             * ========================================
             */

            /**
             * School Search Functions
             */

            // Filter schools based on search query
            function filterSchools(query) {
                if (!query) return schools;
                const lowerQuery = query.toLowerCase();
                return schools.filter(school => school.toLowerCase().includes(lowerQuery));
            }

            // Render school dropdown items
            function renderSchoolDropdown(filteredSchools) {
                schoolDropdown.innerHTML = '';

                if (filteredSchools.length === 0) {
                    const noResults = document.createElement('div');
                    noResults.className = 'school-dropdown-item no-results';
                    noResults.textContent = 'No schools found';
                    schoolDropdown.appendChild(noResults);
                } else {
                    filteredSchools.forEach(school => {
                        const item = document.createElement('div');
                        item.className = 'school-dropdown-item';
                        if (school === selectedSchool) {
                            item.classList.add('selected');
                        }
                        item.textContent = school;
                        item.addEventListener('click', function() {
                            selectSchool(school);
                        });
                        schoolDropdown.appendChild(item);
                    });
                }
            }

            // Select a school
            function selectSchool(school) {
                selectedSchool = school;
                schoolInput.value = school;

                // Update city based on school
                if (schoolCityMap[school]) {
                    cityInput.value = schoolCityMap[school];
                } else {
                    cityInput.value = '';
                }

                // Hide dropdown
                schoolDropdown.style.display = 'none';

                // Update auto-generated fields
                updateAutoGeneratedFields();
            }

            // Show dropdown
            function showDropdown() {
                const query = schoolInput.value;
                const filteredSchools = filterSchools(query);
                renderSchoolDropdown(filteredSchools);
                schoolDropdown.style.display = 'block';
            }

            // Hide dropdown
            function hideDropdown() {
                setTimeout(() => {
                    schoolDropdown.style.display = 'none';
                }, 200);
            }

            // Extract grade number from grade text (e.g., "Standard 9" -> "9")
            function extractGradeNumber(gradeText) {
                const match = gradeText.match(/\d+/);
                return match ? match[0] : '';
            }

            // Generate class name from grade and division
            function generateClassName(grade, division) {
                if (!grade || grade === 'Select Grade...' || !division) {
                    return 'Std --';
                }
                const gradeNum = extractGradeNumber(grade);
                return `Std ${gradeNum}${division.toUpperCase()}`;
            }

            // Generate unique class code
            function generateClassCode(year, grade, division) {
                if (!year || !grade || grade === 'Select Grade...' || !division) {
                    return 'CLS-YYYY-XX-001';
                }
                const gradeNum = extractGradeNumber(grade);
                const yearStart = year.split('-')[0];
                const randomId = Math.floor(Math.random() * 900) + 100; // Random 3-digit number
                return `CLS-${yearStart}-${gradeNum}${division.toUpperCase()}-${randomId.toString().padStart(3, '0')}`;
            }

            // Validate form fields
            function validateForm() {
                const errors = [];

                // Check school selection
                if (!selectedSchool || selectedSchool.trim() === '') {
                    errors.push('Please select a school from the dropdown');
                }

                // Verify the school exists in the list
                if (selectedSchool && !schools.includes(selectedSchool)) {
                    errors.push('Please select a valid school from the dropdown');
                }

                // Check grade selection
                if (!gradeSelect.value || gradeSelect.value === 'Select Grade...') {
                    errors.push('Please select a grade/standard');
                }

                // Check division input
                if (!divisionInput.value || divisionInput.value.trim() === '') {
                    errors.push('Please enter a division');
                }

                return errors;
            }

            // Show validation errors
            function showValidationErrors(errors) {
                if (errors.length > 0) {
                    alert('Please fix the following errors:\n\n' + errors.join('\n'));
                    return false;
                }
                return true;
            }

            /**
             * ========================================
             * EVENT HANDLERS
             * ========================================
             */

            // School input - search and filter
            schoolInput.addEventListener('input', function() {
                showDropdown();
            });

            // School input - show all options on focus
            schoolInput.addEventListener('focus', function() {
                showDropdown();
            });

            // School input - hide dropdown on blur
            schoolInput.addEventListener('blur', function() {
                hideDropdown();
            });

            // Click outside to close dropdown
            document.addEventListener('click', function(e) {
                if (!schoolInput.contains(e.target) && !schoolDropdown.contains(e.target)) {
                    schoolDropdown.style.display = 'none';
                }
            });

            // Academic year change - update class code
            academicYearSelect.addEventListener('change', function() {
                updateAutoGeneratedFields();
            });

            // Grade selection change - update class name and code
            gradeSelect.addEventListener('change', function() {
                updateAutoGeneratedFields();
            });

            // Division input change - update class name and code
            divisionInput.addEventListener('input', function() {
                // Convert to uppercase automatically
                this.value = this.value.toUpperCase();
                updateAutoGeneratedFields();
            });

            // Update auto-generated fields (class name and code)
            function updateAutoGeneratedFields() {
                const grade = gradeSelect.value;
                const division = divisionInput.value;
                const year = academicYearSelect.value;

                // Update class name
                const className = generateClassName(grade, division);
                classNameDisplay.textContent = className;

                // Update class code
                const classCode = generateClassCode(year, grade, division);
                classCodeDisplay.textContent = classCode;
            }

            // Save button click - validate and submit
            saveButton.addEventListener('click', function(e) {
                e.preventDefault();

                // Validate form
                const errors = validateForm();
                if (!showValidationErrors(errors)) {
                    return;
                }

                // Collect form data
                const formData = {
                    school: selectedSchool,
                    city: cityInput.value,
                    academicYear: academicYearSelect.value,
                    grade: gradeSelect.value,
                    division: divisionInput.value,
                    className: classNameDisplay.textContent,
                    classCode: classCodeDisplay.textContent,
                    coach: coachSelect.value,
                    sessions: sessionsInput.value,
                    classStatus: document.getElementById('classStatus').checked,
                    studentVisibility: document.getElementById('studentVisibility').checked,
                    parentVisibility: document.getElementById('parentVisibility').checked
                };

                console.log('Form Data:', formData);

                // Show success message
                alert('Class created successfully!\n\nClass Name: ' + formData.className + '\nClass Code: ' + formData.classCode);

                // Redirect to class list after saving
                setTimeout(function() {
                    window.location.href = 'class-list.html';
                }, 500);
            });

            // Cancel button - already has onclick handler in HTML

            /**
             * ========================================
             * INITIALIZE ON PAGE LOAD
             * ========================================
             */

            // Initialize auto-generated fields with current values
            updateAutoGeneratedFields();

            console.log('Add Class form initialized successfully');
        });
    </script>
</body>

</html>
