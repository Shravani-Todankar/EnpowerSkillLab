<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Class List - Super Admin</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />

    <!-- Sidebar JS -->
    <script src="sidebar.js"></script>
    <!-- Header JS -->
    <script src="header.js"></script>

    <style>
        /* Prevent FOUC - hide containers until loaded */
        #sidebar-container:empty,
        #header-container:empty {
            opacity: 0;
            visibility: hidden;
        }

        #sidebar-container.loaded,
        #header-container.loaded {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.2s ease-in;
        }

        :root {
            --primary: #5b1f6f;
            --background-light: #f7f6f8;
            --background-dark: #1c131f;
            --text-main: #161217;
            --text-subtle: #7c6882;
            --border-color: #e2dde4;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-light);
            color: var(--text-main);
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .content-wrapper {
            flex: 1;
            padding: 0px 15px 0px 15px;
        }

        .btn-primary-custom {
            background-color: var(--primary);
            color: white;
            border: none;
            font-weight: 600;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .btn-primary-custom:hover {
            background-color: #4a195b;
            color: white;
        }

        .filter-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .form-label-custom {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-subtle);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.375rem;
        }

        .form-select-custom,
        .form-control-custom {
            background-color: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            height: 40px;
            font-size: 0.875rem;
            color: var(--text-main);
        }

        .form-select-custom:focus,
        .form-control-custom:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(91, 31, 111, 0.25);
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        /* Custom scrollbar styling */
        .table-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        table.dataTable {
            width: 100% !important;
            border-collapse: collapse;
            table-layout: auto;
        }

        table.dataTable thead {
            background-color: #fafafa;
            border-bottom: 1px solid #e5e7eb;
        }

        table.dataTable thead th {
            padding: 14px 16px !important;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: #666 !important;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #e5e7eb !important;
            background-color: #fafafa !important;
            white-space: nowrap;
        }

        table.dataTable tbody tr {
            border-bottom: 1px solid #f0f0f0;
        }

        table.dataTable tbody td {
            padding: 16px 16px !important;
            font-size: 14px;
            color: #333;
            vertical-align: middle;
            border-bottom: 1px solid #f0f0f0 !important;
        }

        /* Specific column widths */
        table.dataTable thead th:nth-child(1),
        table.dataTable tbody td:nth-child(1) {
            width: 25%;
            min-width: 220px;
        }

        table.dataTable thead th:nth-child(2),
        table.dataTable tbody td:nth-child(2) {
            width: 12%;
            min-width: 120px;
        }

        table.dataTable thead th:nth-child(3),
        table.dataTable tbody td:nth-child(3) {
            width: 12%;
            min-width: 120px;
        }

        table.dataTable thead th:nth-child(4),
        table.dataTable tbody td:nth-child(4) {
            width: 20%;
            min-width: 180px;
        }

        table.dataTable thead th:nth-child(5),
        table.dataTable tbody td:nth-child(5) {
            width: 8%;
            min-width: 80px;
            text-align: center;
        }

        table.dataTable thead th:nth-child(6),
        table.dataTable tbody td:nth-child(6) {
            width: 10%;
            min-width: 100px;
        }

        table.dataTable thead th:nth-child(7),
        table.dataTable tbody td:nth-child(7) {
            width: 13%;
            min-width: 130px;
            text-align: center;
        }

        table.dataTable tbody tr.school-group {
            background-color: #fafafa !important;
        }

        table.dataTable tbody tr.school-group td {
            padding: 12px 24px !important;
            font-weight: 600;
        }

        table.dataTable tbody tr.school-group:hover {
            background-color: #fafafa !important;
        }

        table.dataTable.no-footer {
            border-bottom: none;
        }

        table.dataTable thead .sorting,
        table.dataTable thead .sorting_asc,
        table.dataTable thead .sorting_desc {
            background-image: none;
        }

        /* Hide DataTables default pagination and info */
        .dataTables_wrapper .dataTables_info,
        .dataTables_wrapper .dataTables_paginate,
        .dataTables_wrapper .dataTables_length {
            display: none !important;
        }

        .dataTables_wrapper .dataTables_filter {
            display: none;
        }

        .school-name {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--primary);
            font-size: 13px;
        }

        .school-icon {
            width: 16px;
            height: 16px;
        }

        .teacher-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .teacher-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            background-color: #e5e7eb;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-active {
            background-color: #dcfce7;
            color: #16a34a;
        }

        .status-archived {
            background-color: #f3f4f6;
            color: #6b7280;
        }

        .actions-cell {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            color: #666;
        }

        .action-btn:hover {
            background-color: #f3f4f6;
            color: #333;
        }

        .action-btn svg {
            width: 18px;
            height: 18px;
            display: block;
        }

        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-top: 1px solid #e5e7eb;
        }

        .pagination-info {
            font-size: 13px;
            color: #666;
        }

        .pagination-info strong {
            color: #333;
            font-weight: 600;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .rows-per-page {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #666;
        }

        .rows-per-page select {
            padding: 6px 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 13px;
        }

        .pagination-buttons {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .page-btn {
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            background-color: transparent;
            color: #666;
        }

        .page-btn:hover:not(.active):not(:disabled) {
            background-color: #f3f4f6;
        }

        .page-btn.active {
            background-color: var(--primary);
            color: white;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-btn svg {
            width: 16px;
            height: 16px;
        }

        .page-ellipsis {
            padding: 0 4px;
            color: #666;
        }

        /* ================= Edit Drawer Styles ================= */
        .drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1040;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .drawer-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .edit-drawer {
            position: fixed;
            top: 0;
            right: -600px;
            width: 600px;
            height: 100%;
            background: white;
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
            z-index: 1050;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
        }

        .edit-drawer.active {
            right: 0;
        }

        .drawer-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-shrink: 0;
        }

        .drawer-header-content h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-main);
            margin: 0 0 0.25rem 0;
        }

        .drawer-header-content p {
            font-size: 0.875rem;
            color: var(--text-subtle);
            margin: 0;
        }

        .drawer-close-btn {
            background: none;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            color: var(--text-subtle);
            border-radius: 0.375rem;
            transition: all 0.2s;
        }

        .drawer-close-btn:hover {
            background-color: var(--background-light);
            color: var(--text-main);
        }

        .drawer-body {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem 2rem 2rem;
        }

        .drawer-body::-webkit-scrollbar {
            width: 8px;
        }

        .drawer-body::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .drawer-body::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .drawer-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .drawer-card-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.25rem;
        }

        .drawer-card-header .material-symbols-outlined {
            color: var(--primary);
            font-size: 20px;
        }

        .drawer-card-header h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-main);
            margin: 0;
        }

        .drawer-form-group {
            margin-bottom: 1rem;
        }

        .drawer-form-group:last-child {
            margin-bottom: 0;
        }

        .drawer-form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 0.5rem;
            display: block;
        }

        .drawer-form-label .required {
            color: #dc3545;
            margin-left: 0.25rem;
        }

        .drawer-helper-text {
            font-size: 0.75rem;
            color: var(--text-subtle);
            margin-top: 0.375rem;
            display: block;
        }

        .drawer-form-control,
        .drawer-form-select {
            background-color: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.625rem 0.75rem;
            font-size: 0.875rem;
            color: var(--text-main);
            width: 100%;
            transition: all 0.2s;
        }

        .drawer-form-control:focus,
        .drawer-form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(91, 31, 111, 0.25);
            outline: none;
        }

        .drawer-form-control:read-only {
            background-color: #f0f0f0;
            color: var(--text-subtle);
            cursor: not-allowed;
        }

        .drawer-form-control:disabled,
        .drawer-form-select:disabled {
            background-color: #f0f0f0;
            color: var(--text-subtle);
            cursor: not-allowed;
        }

        .drawer-toggle-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .drawer-toggle-group:last-child {
            border-bottom: none;
        }

        .drawer-toggle-label {
            display: flex;
            flex-direction: column;
        }

        .drawer-toggle-label .toggle-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-main);
        }

        .drawer-toggle-label .toggle-description {
            font-size: 0.75rem;
            color: var(--text-subtle);
        }

        .drawer-toggle-switch {
            position: relative;
            width: 44px;
            height: 22px;
            background: #d1d5db;
            border-radius: 22px;
            cursor: pointer;
            transition: background 0.3s ease;
            border: 2px solid #d1d5db;
        }

        .drawer-toggle-switch::after {
            content: "";
            width: 18px;
            height: 18px;
            background: #fff;
            position: absolute;
            left: 2px;
            border-radius: 50%;
            transition: left 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .drawer-toggle-switch.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .drawer-toggle-switch.active::after {
            left: 22px;
        }

        .drawer-warning {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            font-size: 0.8125rem;
            color: #856404;
            margin-top: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .drawer-warning .material-symbols-outlined {
            font-size: 18px;
            color: #ffc107;
        }

        .drawer-footer {
            padding: 1.25rem 2rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            flex-shrink: 0;
            background: white;
        }

        .btn-drawer-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            font-weight: 600;
            border-radius: 0.5rem;
            padding: 0.625rem 1.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-drawer-primary:hover {
            background-color: #4a195b;
        }

        .btn-drawer-secondary {
            background-color: white;
            color: var(--text-main);
            border: 1px solid var(--border-color);
            font-weight: 600;
            border-radius: 0.5rem;
            padding: 0.625rem 1.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-drawer-secondary:hover {
            background-color: var(--background-light);
        }

        @media (max-width: 768px) {
            .edit-drawer {
                width: 100%;
                right: -100%;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Header -->
            <div id="header-container"></div>

            <!-- Content -->
            <div class="content-wrapper">
                <main class="container-xl py-5" style="max-width: 1600px;">
                    <!-- Page Header -->
                    <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3 mb-4">
                        <div>
                            <h1 class="h3 mb-1 fw-bold">Class List</h1>
                            <p class="text-muted mb-0" style="font-size: 0.875rem;">Manage class structure across all schools.</p>
                        </div>
                        <button class="btn-primary-custom" onclick="window.location.href='add-class.html'">
                            <span class="material-symbols-outlined" style="font-size: 20px;">add</span>
                            <span>Add Class</span>
                        </button>
                    </div>

                    <!-- Filters Section -->
                    <div class="filter-card">
                        <div class="row g-3">
                            <!-- Location Filter -->
                            <div class="col-12 col-sm-6 col-lg-3 col-xl">
                                <label class="form-label-custom">Location</label>
                                <select class="form-select form-select-custom" id="locationFilter">
                                    <option value="">All Locations</option>
                                    <option value="Mumbai">Mumbai</option>
                                    <option value="Delhi">Delhi</option>
                                    <option value="Pune">Pune</option>
                                </select>
                            </div>

                            <!-- School Filter -->
                            <div class="col-12 col-sm-6 col-lg-3 col-xl">
                                <label class="form-label-custom">School</label>
                                <select class="form-select form-select-custom" id="schoolFilter">
                                    <option value="">All Schools</option>
                                    <option value="Greenwood High">Greenwood High</option>
                                    <option value="St. Xaviers">St. Xaviers</option>
                                </select>
                            </div>

                            <!-- Academic Year Filter -->
                            <div class="col-12 col-sm-6 col-lg-2 col-xl">
                                <label class="form-label-custom">Year</label>
                                <select class="form-select form-select-custom" id="yearFilter">
                                    <option value="">All Years</option>
                                    <option value="2023-2024">2023-2024</option>
                                    <option value="2024-2025">2024-2025</option>
                                    <option value="2025-2026">2025-2026</option>
                                </select>
                            </div>

                            <!-- Status Filter -->
                            <div class="col-12 col-sm-6 col-lg-2 col-xl">
                                <label class="form-label-custom">Status</label>
                                <select class="form-select form-select-custom" id="statusFilter">
                                    <option value="">All Statuses</option>
                                    <option value="Active">Active</option>
                                    <option value="Archived">Archived</option>
                                </select>
                            </div>

                            <!-- Search Input -->
                            <div class="col-12 col-lg-4 col-xl">
                                <label class="form-label-custom">Search</label>
                                <div class="position-relative">
                                    <input type="text" id="globalSearch" class="form-control form-control-custom ps-5" placeholder="Search Grade or Section...">
                                    <span class="material-symbols-outlined position-absolute" style="left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--text-subtle); font-size: 20px;">search</span>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end mt-3">
                            <button class="btn btn-link text-decoration-none fw-medium p-0" id="resetFiltersBtn" style="color: var(--primary); font-size: 0.875rem;">
                                <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">refresh</span>
                                Reset Filters
                            </button>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="card">
                        <div class="table-container">
                            <table id="classTable" class="table">
                                <thead>
                                    <tr>
                                        <th>School Name</th>
                                        <th>Class</th>
                                        <th>Academic Year</th>
                                        <th>Thinking Coach</th>
                                        <th>Students</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-school="Greenwood High - Mumbai">
                                        <td>
                                            <div class="school-name">
                                                <svg class="school-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                                                Greenwood High - Mumbai
                                            </div>
                                        </td>
                                        <td>Grade 10 A</td>
                                        <td>2023-2024</td>
                                        <td><div class="teacher-cell"><img src="https://i.pravatar.cc/32?img=1" class="teacher-avatar"><span>Sarah Jenkins</span></div></td>
                                        <td>32</td>
                                        <td><span class="status-badge status-active">Active</span></td>
                                        <td><div class="actions-cell"><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button></div></td>
                                    </tr>
                                    <tr data-school="Greenwood High - Mumbai">
                                        <td>
                                            <div class="school-name">
                                                <svg class="school-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                                                Greenwood High - Mumbai
                                            </div>
                                        </td>
                                        <td>Grade 10 B</td>
                                        <td>2024-2025</td>
                                        <td><div class="teacher-cell"><img src="https://i.pravatar.cc/32?img=11" class="teacher-avatar"><span>Rajesh Kumar</span></div></td>
                                        <td>30</td>
                                        <td><span class="status-badge status-active">Active</span></td>
                                        <td><div class="actions-cell"><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button></div></td>
                                    </tr>
                                    <tr data-school="St. Xaviers - Delhi">
                                        <td>
                                            <div class="school-name">
                                                <svg class="school-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                                                St. Xaviers - Delhi
                                            </div>
                                        </td>
                                        <td>Grade 9 A</td>
                                        <td>2023-2024</td>
                                        <td><div class="teacher-cell"><img src="https://i.pravatar.cc/32?img=5" class="teacher-avatar"><span>Emily Chen</span></div></td>
                                        <td>28</td>
                                        <td><span class="status-badge status-active">Active</span></td>
                                        <td><div class="actions-cell"><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button></div></td>
                                    </tr>
                                    <tr data-school="St. Xaviers - Delhi">
                                        <td>
                                            <div class="school-name">
                                                <svg class="school-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                                                St. Xaviers - Delhi
                                            </div>
                                        </td>
                                        <td>Grade 9 B</td>
                                        <td>2023-2024</td>
                                        <td><div class="teacher-cell"><img src="https://i.pravatar.cc/32?img=12" class="teacher-avatar"><span>Michael Scott</span></div></td>
                                        <td>29</td>
                                        <td><span class="status-badge status-archived">Archived</span></td>
                                        <td><div class="actions-cell"><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button></div></td>
                                    </tr>
                                    <tr data-school="St. Xaviers - Delhi">
                                        <td>
                                            <div class="school-name">
                                                <svg class="school-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                                                St. Xaviers - Delhi
                                            </div>
                                        </td>
                                        <td>Grade 8 A</td>
                                        <td>2025-2026</td>
                                        <td><div class="teacher-cell"><img src="https://i.pravatar.cc/32?img=9" class="teacher-avatar"><span>Pam Beesly</span></div></td>
                                        <td>31</td>
                                        <td><span class="status-badge status-active">Active</span></td>
                                        <td><div class="actions-cell"><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button><button class="action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button></div></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="pagination-container">
                            <div class="pagination-info">Showing <strong id="startEntry">1</strong> to <strong id="endEntry">5</strong> of <strong id="totalEntries">5</strong> classes</div>
                            <div class="pagination-controls">
                                <div class="rows-per-page">
                                    <span>Rows per page:</span>
                                    <select id="rowsPerPage"><option>10</option><option>25</option><option>50</option></select>
                                </div>
                                <div class="pagination-buttons" id="paginationButtons">
                                    <!-- Pagination buttons will be generated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Drawer Overlay -->
    <div class="drawer-overlay" id="drawerOverlay"></div>

    <!-- Edit Class Drawer -->
    <div class="edit-drawer" id="editDrawer">
        <!-- Drawer Header -->
        <div class="drawer-header">
            <div class="drawer-header-content">
                <h2>Edit Class</h2>
                <p>Editing: <span id="editingClassName">Std 9A</span></p>
            </div>
            <button class="drawer-close-btn" id="closeDrawerBtn">
                <span class="material-symbols-outlined" style="font-size: 24px;">close</span>
            </button>
        </div>

        <!-- Drawer Body (Scrollable) -->
        <div class="drawer-body">
            <!-- Section 1: Class Details -->
            <div class="drawer-card">
                <div class="drawer-card-header">
                    <span class="material-symbols-outlined">meeting_room</span>
                    <h3>Class Details</h3>
                </div>
                <div class="drawer-form-group">
                    <label class="drawer-form-label">Grade / Standard <span class="required">*</span></label>
                    <select class="drawer-form-select" id="editGrade">
                        <option value="">Select Grade</option>
                        <option value="6">Std 6</option>
                        <option value="7">Std 7</option>
                        <option value="8">Std 8</option>
                        <option value="9" selected>Std 9</option>
                        <option value="10">Std 10</option>
                    </select>
                </div>

                <div class="drawer-form-group">
                    <label class="drawer-form-label">Division <span class="required">*</span></label>
                    <select class="drawer-form-select" id="editDivision">
                        <option value="">Select Division</option>
                        <option value="A" selected>A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                </div>

                <div class="drawer-form-group">
                    <label class="drawer-form-label">Class Name</label>
                    <input type="text" class="drawer-form-control" id="editClassName" value="Std 9A" readonly>
                    <small class="drawer-helper-text">Class name updates automatically based on Grade and Division.</small>
                </div>

                <div class="drawer-form-group">
                    <label class="drawer-form-label">Class Code</label>
                    <input type="text" class="drawer-form-control" id="editClassCode" value="CLS-2025-9A-482" readonly>
                </div>
            </div>

            <!-- Section 2: School & Academic Context -->
            <div class="drawer-card">
                <div class="drawer-card-header">
                    <span class="material-symbols-outlined">school</span>
                    <h3>School & Academic Context</h3>
                </div>
                <div class="drawer-form-group">
                    <label class="drawer-form-label">School Name <span class="required">*</span></label>
                    <select class="drawer-form-select" id="editSchool">
                        <option value="">Select School</option>
                        <option value="Greenwood High" selected>Greenwood International High</option>
                        <option value="St. Xaviers">St. Xavier's Academy</option>
                        <option value="Modern Public">Modern Public School</option>
                    </select>
                    <small class="drawer-helper-text">Changing school impacts reports and attendance data.</small>
                </div>

                <div class="drawer-form-group">
                    <label class="drawer-form-label">City / Location</label>
                    <input type="text" class="drawer-form-control" id="editCity" value="Mumbai, India" readonly>
                </div>

                <div class="drawer-form-group">
                    <label class="drawer-form-label">Academic Year <span class="required">*</span></label>
                    <select class="drawer-form-select" id="editAcademicYear">
                        <option value="2025-2026" selected>2025-2026</option>
                        <option value="2024-2025">2024-2025</option>
                        <option value="2023-2024">2023-2024</option>
                    </select>
                    <small class="drawer-helper-text">Changing academic year impacts reports and attendance data.</small>
                </div>
            </div>

            <!-- Section 3: Thinking Coach Assignment -->
            <div class="drawer-card">
                <div class="drawer-card-header">
                    <span class="material-symbols-outlined">person_check</span>
                    <h3>Thinking Coach Assignment</h3>
                </div>
                <div class="drawer-form-group">
                    <label class="drawer-form-label">Thinking Coach</label>
                    <select class="drawer-form-select" id="editCoach">
                        <option value="">Select Coach</option>
                        <option value="Sarah Jenkins" selected>Sarah Jenkins</option>
                        <option value="Michael Chen">Michael Chen</option>
                        <option value="Priya Patel">Priya Patel</option>
                        <option value="Rajesh Kumar">Rajesh Kumar</option>
                    </select>
                    <small class="drawer-helper-text">This coach manages attendance, assignments, and assessments for this class.</small>
                </div>
            </div>

            <!-- Section 4: Program Configuration -->
            <div class="drawer-card">
                <div class="drawer-card-header">
                    <span class="material-symbols-outlined">event_note</span>
                    <h3>Program Configuration</h3>
                </div>
                <div class="drawer-form-group">
                    <label class="drawer-form-label">Total Sessions <span class="required">*</span></label>
                    <input type="number" class="drawer-form-control" id="editSessions" value="48" min="1" max="100">
                    <small class="drawer-helper-text">Each class runs for min 48 sessions in one academic year.</small>
                </div>
            </div>

            <!-- Section 5: Class Status & Visibility -->
            <div class="drawer-card">
                <div class="drawer-card-header">
                    <span class="material-symbols-outlined">settings</span>
                    <h3>Class Status & Visibility</h3>
                </div>

                <div class="drawer-toggle-group">
                    <div class="drawer-toggle-label">
                        <span class="toggle-title">Class Status</span>
                        <span class="toggle-description">Active / Inactive</span>
                    </div>
                    <div class="drawer-toggle-switch active" id="editClassStatus"></div>
                </div>

                <div class="drawer-toggle-group">
                    <div class="drawer-toggle-label">
                        <span class="toggle-title">Visible to Students</span>
                        <span class="toggle-description">Show in student dashboards</span>
                    </div>
                    <div class="drawer-toggle-switch active" id="editStudentVisibility"></div>
                </div>

                <div class="drawer-toggle-group">
                    <div class="drawer-toggle-label">
                        <span class="toggle-title">Visible to Parents</span>
                        <span class="toggle-description">Show in parent portals</span>
                    </div>
                    <div class="drawer-toggle-switch" id="editParentVisibility"></div>
                </div>

                <div class="drawer-warning">
                    <span class="material-symbols-outlined">warning</span>
                    <span>Inactive classes will not appear in dashboards or reports.</span>
                </div>
            </div>
        </div>

        <!-- Drawer Footer (Sticky) -->
        <div class="drawer-footer">
            <button class="btn-drawer-secondary" id="cancelDrawerBtn">Cancel</button>
            <button class="btn-drawer-primary" id="updateClassBtn">Update Class</button>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <!-- RowGroup extension -->
    <script src="https://cdn.datatables.net/rowgroup/1.4.0/js/dataTables.rowGroup.min.js"></script>

    <script>
        // Load sidebar
        fetch('sidebar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('sidebar-container').innerHTML = data;
                document.getElementById('sidebar-container').classList.add('loaded');
            })
            .catch(error => console.error('Error loading sidebar:', error));

        // Load header
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                document.getElementById('header-container').classList.add('loaded');
            })
            .catch(error => console.error('Error loading header:', error));

        // Initialize DataTable with RowGroup
        $(document).ready(function() {
            /**
             * ========================================
             * UTILITY FUNCTION: Extract Plain Text from HTML
             * ========================================
             * DataTables passes column data as HTML strings.
             * We need to extract plain text for reliable filtering.
             *
             * This function creates a temporary DOM element,
             * sets its HTML content, then extracts text content.
             */
            function extractPlainText(html) {
                if (!html) return '';
                // Create temporary element to parse HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                // Get text content and normalize whitespace
                return tempDiv.textContent.trim().replace(/\s+/g, ' ');
            }

            /**
             * ========================================
             * CUSTOM FILTER FUNCTION FOR DATATABLES
             * ========================================
             */
            $.fn.dataTable.ext.search.push(
                function(settings, data, dataIndex) {
                    // Only apply to our specific table
                    if (settings.nTable.id !== 'classTable') {
                        return true;
                    }

                    // Get current filter values
                    const locationFilter = $('#locationFilter').val();
                    const schoolFilter = $('#schoolFilter').val();
                    const yearFilter = $('#yearFilter').val();
                    const statusFilter = $('#statusFilter').val();

                    // Extract plain text from HTML columns
                    // Column indices: 0=School Name, 1=Class, 2=Academic Year, 3=Thinking Coach, 4=Students, 5=Status, 6=Actions
                    const schoolNameText = extractPlainText(data[0]); // School Name column
                    const yearText = extractPlainText(data[2]); // Academic Year column
                    const statusText = extractPlainText(data[5]); // Status column

                    console.log('Filter called - Location:', locationFilter, 'School Name:', schoolNameText);

                    // Apply Location Filter - Check if school name contains the location
                    if (locationFilter && schoolNameText.indexOf(locationFilter) === -1) {
                        console.log('Hiding row - Location filter failed');
                        return false;
                    }

                    // Apply School Filter - Check if school name contains the school
                    if (schoolFilter && schoolNameText.indexOf(schoolFilter) === -1) {
                        console.log('Hiding row - School filter failed');
                        return false;
                    }

                    // Apply Academic Year Filter - Check if year matches
                    if (yearFilter && yearText.indexOf(yearFilter) === -1) {
                        console.log('Hiding row - Year filter failed');
                        return false;
                    }

                    // Apply Status Filter - Check if status matches
                    if (statusFilter && statusText.indexOf(statusFilter) === -1) {
                        console.log('Hiding row - Status filter failed');
                        return false;
                    }

                    // All filters passed - show this row
                    return true;
                }
            );

            /**
             * ========================================
             * DATATABLE INITIALIZATION
             * ========================================
             */

            // Declare table variable first
            let table;

            // Update pagination info function
            const updatePaginationInfo = function() {
                if (!table) return; // Guard against early calls
                const info = table.page.info();
                $('#startEntry').text(info.start + 1);
                $('#endEntry').text(info.end);
                $('#totalEntries').text(info.recordsDisplay);

                // Generate pagination buttons
                generatePaginationButtons(info);
            }

            // Generate custom pagination buttons function
            const generatePaginationButtons = function(info) {
                if (!table) return; // Guard against early calls
                const container = $('#paginationButtons');
                container.empty();

                const totalPages = info.pages;
                const currentPage = info.page;

                // Previous button
                const prevBtn = $('<button class="page-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>');
                if (currentPage === 0 || totalPages === 0) prevBtn.attr('disabled', true);
                prevBtn.on('click', function() {
                    table.page('previous').draw('page');
                });
                container.append(prevBtn);

                // Page number buttons
                if (totalPages > 0) {
                    for (let i = 0; i < totalPages; i++) {
                        if (i === 0 || i === totalPages - 1 || (i >= currentPage - 1 && i <= currentPage + 1)) {
                            const pageBtn = $('<button class="page-btn">' + (i + 1) + '</button>');
                            if (i === currentPage) pageBtn.addClass('active');
                            pageBtn.on('click', function() {
                                table.page(i).draw('page');
                            });
                            container.append(pageBtn);
                        } else if (i === currentPage - 2 || i === currentPage + 2) {
                            container.append('<span class="page-ellipsis">...</span>');
                        }
                    }
                }

                // Next button
                const nextBtn = $('<button class="page-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>');
                if (currentPage === totalPages - 1 || totalPages === 0) nextBtn.attr('disabled', true);
                nextBtn.on('click', function() {
                    table.page('next').draw('page');
                });
                container.append(nextBtn);
            }

            // Initialize DataTable
            table = $('#classTable').DataTable({
                pageLength: 10,
                order: [[0, 'asc'], [1, 'asc']], // Sort by School Name, then Class
                autoWidth: false,
                columnDefs: [
                    { orderable: false, targets: [6], className: 'text-center' }, // Disable sorting on Actions column
                    { className: 'text-center', targets: [4, 6] } // Center align Students, Actions
                ],
                drawCallback: function() {
                    updatePaginationInfo();
                }
            });

            /**
             * ========================================
             * FILTER EVENT HANDLERS
             * ========================================
             */

            // Global Search Input
            $('#globalSearch').on('keyup', function() {
                console.log('Search input:', this.value);
                table.search(this.value).draw();
            });

            // Location Filter
            $('#locationFilter').on('change', function() {
                console.log('Location filter changed to:', this.value);
                table.draw();
            });

            // School Filter
            $('#schoolFilter').on('change', function() {
                console.log('School filter changed to:', this.value);
                table.draw();
            });

            // Academic Year Filter
            $('#yearFilter').on('change', function() {
                console.log('Year filter changed to:', this.value);
                table.draw();
            });

            // Status Filter
            $('#statusFilter').on('change', function() {
                console.log('Status filter changed to:', this.value);
                table.draw();
            });

            // Reset Filters Button
            $('#resetFiltersBtn').on('click', function(e) {
                e.preventDefault();
                console.log('Resetting all filters');

                // Clear all filter dropdowns
                $('#locationFilter').val('');
                $('#schoolFilter').val('');
                $('#yearFilter').val('');
                $('#statusFilter').val('');
                $('#globalSearch').val('');

                // Clear DataTables search and redraw
                table.search('').draw();
            });

            // Rows per page change
            $('#rowsPerPage').on('change', function() {
                table.page.len(parseInt($(this).val())).draw();
            });

            // Initial pagination update
            updatePaginationInfo();
        });

        /**
         * ========================================
         * EDIT DRAWER FUNCTIONALITY
         * ========================================
         */

        // School to City mapping
        const schoolCityMap = {
            'Greenwood High': 'Mumbai, India',
            'St. Xaviers': 'Delhi, India',
            'Modern Public': 'Pune, India'
        };

        // Open drawer function
        function openEditDrawer() {
            $('#drawerOverlay').addClass('active');
            $('#editDrawer').addClass('active');
            $('body').css('overflow', 'hidden');
        }

        // Close drawer function
        function closeEditDrawer() {
            $('#drawerOverlay').removeClass('active');
            $('#editDrawer').removeClass('active');
            $('body').css('overflow', '');
        }

        // Close drawer on overlay click
        $('#drawerOverlay').on('click', function() {
            closeEditDrawer();
        });

        // Close drawer on close button click
        $('#closeDrawerBtn').on('click', function() {
            closeEditDrawer();
        });

        // Close drawer on cancel button click
        $('#cancelDrawerBtn').on('click', function() {
            closeEditDrawer();
        });

        // Escape key to close drawer
        $(document).on('keydown', function(e) {
            if (e.key === 'Escape' && $('#editDrawer').hasClass('active')) {
                closeEditDrawer();
            }
        });

        // Toggle switches functionality
        $('.drawer-toggle-switch').on('click', function() {
            $(this).toggleClass('active');
        });

        // Auto-update class name when grade or division changes
        $('#editGrade, #editDivision').on('change', function() {
            const grade = $('#editGrade option:selected').text().replace('Std ', '');
            const division = $('#editDivision').val();

            if (grade && division) {
                $('#editClassName').val('Std ' + grade + division);
            }
        });

        // Auto-update city when school changes
        $('#editSchool').on('change', function() {
            const school = $(this).val();
            if (schoolCityMap[school]) {
                $('#editCity').val(schoolCityMap[school]);
            }
        });

        // Helper function to extract text from HTML
        function extractTextContent(html) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            return tempDiv.textContent.trim();
        }

        // Store reference to the row being edited
        let currentEditingRow = null;

        // Edit button click handler - attach to table dynamically
        $(document).on('click', '.action-btn:nth-child(2)', function() {
            // Store reference to the row being edited
            currentEditingRow = $(this).closest('tr');
            // This is the edit button (second action button)
            const row = $(this).closest('tr');
            const cells = row.find('td');

            // Extract data from the row
            const schoolNameFull = extractTextContent(cells.eq(0).html()); // e.g., "Greenwood High - Mumbai"
            const classText = cells.eq(1).text().trim(); // e.g., "Grade 10 A"
            const academicYear = cells.eq(2).text().trim(); // e.g., "2023-2024"
            const coachName = cells.eq(3).find('span').text().trim(); // Extract coach name from Thinking Coach cell
            const statusText = extractTextContent(cells.eq(5).html()); // e.g., "Active" or "Archived"

            // Parse school name and city
            const schoolParts = schoolNameFull.split(' - ');
            const schoolName = schoolParts[0].trim();
            const cityName = schoolParts.length > 1 ? schoolParts[1].trim() : '';

            // Parse class text "Grade 10 A" -> grade="10", section="A"
            const classParts = classText.split(' ');
            const gradeNumber = classParts[1]; // "10"
            const section = classParts[2]; // "A"

            // Generate class name
            const className = 'Std ' + gradeNumber + section;

            // Populate drawer header
            $('#editingClassName').text(className);

            // Populate Class Details section
            $('#editGrade').val(gradeNumber);
            $('#editDivision').val(section);
            $('#editClassName').val(className);

            // Generate a class code (you can modify this logic as needed)
            const yearStart = academicYear.split('-')[0];
            const randomId = Math.floor(Math.random() * 900) + 100;
            const classCode = `CLS-${yearStart}-${gradeNumber}${section}-${randomId.toString().padStart(3, '0')}`;
            $('#editClassCode').val(classCode);

            // Populate School & Academic Context section
            // Map school name to dropdown value
            let schoolValue = '';
            if (schoolName.includes('Greenwood')) {
                schoolValue = 'Greenwood High';
            } else if (schoolName.includes('Xavier')) {
                schoolValue = 'St. Xaviers';
            } else if (schoolName.includes('Modern')) {
                schoolValue = 'Modern Public';
            }
            $('#editSchool').val(schoolValue);

            // Set city based on school or extracted city
            if (cityName) {
                $('#editCity').val(cityName + ', India');
            } else if (schoolCityMap[schoolValue]) {
                $('#editCity').val(schoolCityMap[schoolValue]);
            }

            // Set academic year
            $('#editAcademicYear').val(academicYear);

            // Populate Thinking Coach
            $('#editCoach').val(coachName);

            // Set a default session count (you can modify this logic)
            const defaultSessions = 48;
            $('#editSessions').val(defaultSessions);

            // Set Class Status based on status text
            if (statusText === 'Active') {
                $('#editClassStatus').addClass('active');
                $('#editStudentVisibility').addClass('active');
                $('#editParentVisibility').removeClass('active'); // Default inactive
            } else {
                $('#editClassStatus').removeClass('active');
                $('#editStudentVisibility').removeClass('active');
                $('#editParentVisibility').removeClass('active');
            }

            // Open the drawer
            openEditDrawer();
        });

        // Update Class button handler
        $('#updateClassBtn').on('click', function() {
            // Validate that we have a row to update
            if (!currentEditingRow) {
                alert('Error: No class selected for editing');
                return;
            }

            // Collect form data
            const updatedClass = {
                grade: $('#editGrade').val(),
                division: $('#editDivision').val(),
                className: $('#editClassName').val(),
                classCode: $('#editClassCode').val(),
                school: $('#editSchool').val(),
                city: $('#editCity').val(),
                academicYear: $('#editAcademicYear').val(),
                coach: $('#editCoach').val(),
                sessions: $('#editSessions').val(),
                classStatus: $('#editClassStatus').hasClass('active'),
                studentVisibility: $('#editStudentVisibility').hasClass('active'),
                parentVisibility: $('#editParentVisibility').hasClass('active')
            };

            console.log('Updated Class Data:', updatedClass);

            // Update the table row with new data
            const cells = currentEditingRow.find('td');

            // Get school name from dropdown
            const schoolText = $('#editSchool option:selected').text();
            const cityText = $('#editCity').val().split(',')[0]; // Get city part (e.g., "Mumbai" from "Mumbai, India")
            const fullSchoolName = schoolText + ' - ' + cityText;

            // Update School Name (column 0)
            cells.eq(0).html(`
                <div class="school-name">
                    <svg class="school-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    ${fullSchoolName}
                </div>
            `);

            // Update Class (column 1)
            const gradeText = $('#editGrade option:selected').text().replace('Std ', '');
            const classDisplay = 'Grade ' + gradeText + ' ' + updatedClass.division;
            cells.eq(1).text(classDisplay);

            // Update Academic Year (column 2)
            cells.eq(2).text(updatedClass.academicYear);

            // Update Thinking Coach (column 3)
            const coachText = $('#editCoach option:selected').text();
            if (coachText && coachText !== 'Select Coach') {
                // Keep existing avatar or use a default one
                const existingAvatar = cells.eq(3).find('img').attr('src') || 'https://i.pravatar.cc/32?img=' + Math.floor(Math.random() * 70);
                cells.eq(3).html(`
                    <div class="teacher-cell">
                        <img src="${existingAvatar}" class="teacher-avatar">
                        <span>${coachText}</span>
                    </div>
                `);
            }

            // Students count (column 4) - keep existing value
            // No need to update as it's not editable in the drawer

            // Update Status (column 5)
            const statusBadgeClass = updatedClass.classStatus ? 'status-active' : 'status-archived';
            const statusText = updatedClass.classStatus ? 'Active' : 'Archived';
            cells.eq(5).html(`<span class="status-badge ${statusBadgeClass}">${statusText}</span>`);

            // Actions column (column 6) - keep existing buttons
            // No need to update

            // Update the data-school attribute for filtering
            currentEditingRow.attr('data-school', fullSchoolName);

            // Show success message
            alert('Class updated successfully!');

            // Close drawer
            closeEditDrawer();

            // Redraw the table to apply any filters/sorting
            const table = $('#classTable').DataTable();
            table.draw(false); // false = stay on current page
        });
    </script>
</body>

</html>
