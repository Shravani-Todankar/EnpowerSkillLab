<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Bulk Upload - Enpower Skill Lab</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="bulk-upload.css">
    <!-- Sidebar JS -->
    <script src="sidebar.js"></script>
    <!-- Header JS -->
    <script src="header.js"></script>

    <style>
        /* Prevent FOUC - hide containers until loaded */
        #sidebar-container:empty,
        #header-container:empty {
            opacity: 0;
            visibility: hidden;
        }

        #sidebar-container.loaded,
        #header-container.loaded {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.2s ease-in;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Include Sidebar Component -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Include Header Component -->
            <div id="header-container"></div>

            <!-- Bulk Upload Content -->
            <div class="dashboard-page">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-header-content">
                        <h1 class="page-title">
                            <span class="material-symbols-outlined page-title-icon">cloud_upload</span>
                            Bulk User Import
                        </h1>
                        <p class="page-subtitle">Effortlessly add multiple users to your organization in one go.</p>
                    </div>
                    <!-- Progress Stepper -->
                    <div class="stepper-wrapper">
                        <div class="stepper-item active">
                            <div class="stepper-number">1</div>
                            <span class="stepper-label">Upload</span>
                        </div>
                        <div class="stepper-line"></div>
                        <div class="stepper-item">
                            <div class="stepper-number">2</div>
                            <span class="stepper-label">Validate</span>
                        </div>
                        <div class="stepper-line"></div>
                        <div class="stepper-item">
                            <div class="stepper-number">3</div>
                            <span class="stepper-label">Confirm</span>
                        </div>
                    </div>
                </div>

                <!-- Two Column Layout -->
                <div class="row g-4 mb-4">
                    <!-- Left Column: Main Upload Card -->
                    <div class="col-lg-8">
                        <div class="card upload-card">
                            <div class="card-body p-4">
                                <!-- Role Selection -->
                                <div class="mb-4">
                                    <label class="form-label fw-normal text-uppercase" for="role-select">
                                        Step 1.1: Select Role
                                    </label>
                                    <select class="form-select" id="role-select">
                                        <option disabled selected value="">Choose the user type needed...</option>
                                        <option value="school-admin">School Admin</option>
                                        <option value="program-coordinator">Program Coordinator</option>
                                        <option value="thinking-coach">Thinking Coach</option>
                                        <option value="student">Student</option>
                                        <option value="parent">Parent</option>
                                    </select>
                                </div>

                                <!-- Drag & Drop Area -->
                                <div class="mb-4">
                                    <label class="form-label fw-normal text-uppercase">
                                        Step 1.2: Upload CSV
                                    </label>
                                    <div class="upload-area">
                                        <input accept=".csv" class="file-input" type="file" id="csvFile" />
                                        <div class="upload-icon">
                                            <span class="material-symbols-outlined">cloud_upload</span>
                                        </div>
                                        <p class="upload-title">Click to upload or drag and drop</p>
                                        <p class="upload-description">Accepts .csv only (Max 10MB)</p>
                                    </div>
                                </div>

                                <!-- Action Footer -->
                                <div class="d-flex justify-content-between align-items-center pt-3 border-top btn-action">
                                    <button class="btn btn-link text-secondary cbtn-mob" id="cancelBtn">Cancel</button>
                                    <button class="btn btn-validate vfbtn-mob" id="validateBtn">
                                        Validate File
                                        <span class="material-symbols-outlined ms-2">arrow_forward</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Instructions -->
                    <div class="col-lg-4">
                        <div class="card instructions-card">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center gap-3 mb-4">
                                    <div class="instruction-icon">
                                        <span class="material-symbols-outlined">lightbulb</span>
                                    </div>
                                    <h3 class="fw-normal mb-0 fs-4" style="font-weight: 500;">Before you start</h3>
                                </div>

                                <div class="instruction-list">
                                    <div class="instruction-item">
                                        <span class="instruction-number">1</span>
                                        <div>
                                            <p class="fw-bold mb-1">Prepare your data</p>
                                            <p class="text-secondary small mb-0">
                                                Ensure your file is in .CSV format and does not exceed 500 rows per upload.
                                            </p>
                                        </div>
                                    </div>

                                    <div class="instruction-item">
                                        <span class="instruction-number">2</span>
                                        <div>
                                            <p class="fw-bold mb-1">Check required fields</p>
                                            <p class="text-secondary small mb-0">
                                                Columns for <code>Email</code>, <code>First Name</code>, and
                                                <code>Last Name</code> are mandatory.
                                            </p>
                                        </div>
                                    </div>

                                    <div class="instruction-item">
                                        <span class="instruction-number">3</span>
                                        <div>
                                            <p class="fw-bold mb-1">Uniqueness</p>
                                            <p class="text-secondary small mb-0">
                                                Email addresses must be unique within the organization.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="border-top pt-3 mt-4">
                                    <p class="text-uppercase small fw-bold text-secondary mb-3">Resources</p>
                                    <a href="#" class="download-template">
                                        <span class="material-symbols-outlined">download</span>
                                        <div>
                                            <div class="fw-bold">Download Sample CSV</div>
                                            <small class="text-secondary">bulk_import_template_v2.csv</small>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Uploads Section -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3 class="fw-bold mb-0">Recent Uploads</h3>
                        <button class="btn btn-link text-primary fw-bold p-0">View All History</button>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Filename</th>
                                        <th>User Type</th>
                                        <th>Date Uploaded</th>
                                        <th>Status</th>
                                        <th class="text-end">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Row 1 -->
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center gap-3">
                                                <div class="file-icon success">
                                                    <span class="material-symbols-outlined">description</span>
                                                </div>
                                                <span class="fw-medium">students_batch_2023_A.csv</span>
                                            </div>
                                        </td>
                                        <td class="text-secondary">Student</td>
                                        <td class="text-secondary">Oct 24, 2023 • 10:42 AM</td>
                                        <td>
                                            <span class="badge-success">
                                                <span class="badge-dot"></span>
                                                Success
                                            </span>
                                        </td>
                                        <td class="text-end">
                                            <button class="btn btn-link text-primary fw-bold p-0 vr-mob">View Report</button>
                                        </td>
                                    </tr>

                                    <!-- Row 2 -->
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center gap-3">
                                                <div class="file-icon error">
                                                    <span class="material-symbols-outlined">description</span>
                                                </div>
                                                <span class="fw-medium">teachers_new_hires.csv</span>
                                            </div>
                                        </td>
                                        <td class="text-secondary">Teacher</td>
                                        <td class="text-secondary">Oct 22, 2023 • 04:15 PM</td>
                                        <td>
                                            <span class="badge-error">
                                                <span class="badge-dot"></span>
                                                Failed (3 Errors)
                                            </span>
                                        </td>
                                        <td class="text-end">
                                            <button class="btn btn-link text-primary fw-bold p-0 vr-mob">View Errors</button>
                                        </td>
                                    </tr>

                                    <!-- Row 3 -->
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center gap-3">
                                                <div class="file-icon info">
                                                    <span class="material-symbols-outlined">description</span>
                                                </div>
                                                <span class="fw-medium">admins_IT_dept.csv</span>
                                            </div>
                                        </td>
                                        <td class="text-secondary">Admin</td>
                                        <td class="text-secondary">Oct 20, 2023 • 09:00 AM</td>
                                        <td>
                                            <span class="badge-info">
                                                <span class="badge-dot"></span>
                                                Partially Imported
                                            </span>
                                        </td>
                                        <td class="text-end">
                                            <button class="btn btn-link text-primary fw-bold p-0 vr-mob">Review</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Load Sidebar and Header Components
        document.addEventListener('DOMContentLoaded', function() {
            Promise.all([
                fetch('sidebar.html').then(response => response.text()),
                fetch('header.html').then(response => response.text())
            ]).then(([sidebarHTML, headerHTML]) => {
                document.getElementById('sidebar-container').innerHTML = sidebarHTML;
                document.getElementById('header-container').innerHTML = headerHTML;
                // Call header initialization directly instead of relying on DOMContentLoaded
                if (typeof initializeHeader === 'function') {
                    initializeHeader();
                }

                // Wait a bit for sidebar.js to initialize, then set active state
                setTimeout(() => {
                    setActiveMenuItem();
                }, 200);
            });
        });

        function setActiveMenuItem() {
            // Add active state to appropriate sidebar menu item if needed
            const currentPage = window.location.pathname.split('/').pop();
            // Update this based on your sidebar menu structure
        }

        // Initialize file upload functionality
        function initializeFileUpload() {
            const fileInput = document.getElementById('csvFile');
            const uploadArea = document.querySelector('.upload-area');

            if (!fileInput || !uploadArea) {
                console.error('Upload elements not found');
                return;
            }

            // Click event for upload area
            uploadArea.addEventListener('click', (e) => {
                // Prevent click if clicking on the input itself
                if (e.target !== fileInput) {
                    e.preventDefault();
                    e.stopPropagation();
                    fileInput.click();
                }
            });

            // Drag and drop events
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');

                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    // Check if it's a CSV file
                    const file = files[0];
                    if (file.name.toLowerCase().endsWith('.csv')) {
                        fileInput.files = e.dataTransfer.files;
                        handleFileSelection(file);
                    } else {
                        alert('Please upload a CSV file only.');
                    }
                }
            });

            // File input change event
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    handleFileSelection(file);
                }
            });
        }

        // Handle file selection
        function handleFileSelection(file) {
            const fileName = file.name;
            const fileSize = (file.size / (1024 * 1024)).toFixed(2); // Convert to MB

            console.log('File selected:', fileName);
            console.log('File size:', fileSize + ' MB');

            // Check file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('File size exceeds 10MB. Please upload a smaller file.');
                return;
            }

            // Update UI to show selected file
            const uploadTitle = document.querySelector('.upload-title');
            const uploadDescription = document.querySelector('.upload-description');

            if (uploadTitle && uploadDescription) {
                uploadTitle.textContent = fileName;
                uploadDescription.textContent = `File size: ${fileSize} MB - Ready to validate`;
                uploadTitle.style.color = '#6b277e';
            }

            console.log('File ready for upload');
        }

        // Initialize file upload when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit to ensure all elements are loaded
            setTimeout(() => {
                initializeFileUpload();
                initializeButtons();
            }, 300);
        });

        // Initialize button click handlers
        function initializeButtons() {
            const cancelBtn = document.getElementById('cancelBtn');
            const validateBtn = document.getElementById('validateBtn');

            // Cancel button - redirect to dashboard
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.location.href = 'dashboard.html';
                });
            }

            // Validate button - handle file validation
            if (validateBtn) {
                validateBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const fileInput = document.getElementById('csvFile');
                    const roleSelect = document.getElementById('role-select');

                    // Validate role selection
                    if (!roleSelect.value) {
                        alert('Please select a user role before validating the file.');
                        roleSelect.focus();
                        return;
                    }

                    // Validate file selection
                    if (!fileInput.files || fileInput.files.length === 0) {
                        alert('Please select a CSV file to upload.');
                        return;
                    }

                    // If validation passes, proceed (you can add your validation logic here)
                    console.log('Validating file:', fileInput.files[0].name);
                    console.log('Selected role:', roleSelect.value);
                    alert('File validation started! This will proceed to step 2.');

                    // Here you would typically send the file to the server for validation
                    // For now, just showing a success message
                });
            }
        }
    </script>
</body>

</html>
