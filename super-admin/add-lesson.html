<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Lesson â€“ Enpower Skill Lab</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

<!-- Sidebar JS -->
<script src="sidebar.js"></script>
<!-- Header JS -->
<script src="header.js"></script>

<style>
/* Prevent FOUC - hide containers until loaded */
#sidebar-container:empty,
#header-container:empty {
    opacity: 0;
    visibility: hidden;
}

#sidebar-container.loaded,
#header-container.loaded {
    opacity: 1;
    visibility: visible;
    transition: opacity 0.2s ease-in;
}

/* ================= Root ================= */
:root {
    --primary: #5b1f6f;
    --bg-light: #f7f6f8;
    --surface: #ffffff;
    --text-main: #171019;
    --text-secondary: #80588d;
    --border-color: #dfd3e4;
}

body {
    background: var(--bg-light);
    font-family: "Poppins", sans-serif;
    color: var(--text-main);
    margin: 0;
    padding: 0;
}

/* ================= Dashboard Layout ================= */
.dashboard-container {
    display: flex;
    min-height: 100vh;
}

.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
}

.create-head{
    font-weight: 600;
    font-size: 30px;
    margin-bottom: 0;
}

.content-wrapper {
    flex: 1;
    padding: 0px 15px 0px 15px;
}

/* ================= Cards ================= */
.card-box {
    background: var(--surface);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 24px;
}

/* ================= Inputs ================= */
.form-control,
.form-select,
textarea {
    background: #faf9fb;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    font-size: 14px;
}

.form-control:focus,
.form-select:focus,
textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 1px var(--primary);
    background: #fff;
}

/* ================= Upload ================= */
.upload-box {
    border: 2px dashed var(--border-color);
    border-radius: 14px;
    padding: 32px;
    text-align: center;
    background: var(--bg-light);
}

/* ================= Tabs ================= */
.lesson-tabs {
    background: var(--bg-light);
    padding: 6px;
    border-radius: 10px;
    display: flex;
    gap: 6px;
}

.lesson-tabs button {
    flex: 1;
    border: none;
    padding: 10px;
    border-radius: 8px;
    background: transparent;
    color: var(--text-secondary);
    font-weight: 500;
}

.lesson-tabs button.active {
    background: #fff;
    color: var(--primary);
    box-shadow: 0 0 0 1px rgba(0,0,0,.05);
}

/* ================= Editor ================= */
.editor-toolbar {
    background: var(--bg-light);
    border-bottom: 1px solid var(--border-color);
    padding: 8px;
    display: flex;
    gap: 8px;
}

.editor-toolbar button {
    border: none;
    background: transparent;
    color: var(--text-secondary);
}

/* ================= Buttons ================= */
.btn-primary-custom {
    background: var(--primary);
    color: #fff;
    font-weight: 700;
    border-radius: 10px;
}

.publish-btn:hover {
    background: #9141b1;
    color: #fff;
}

.draft-btn:hover {
    background: var(--primary);
    color: #fff;
}

.btn-outline-primary-custom {
    border: 1px solid var(--primary);
    color: var(--primary);
    font-weight: 600;
    border-radius: 10px;
}

/* ================= Assignment ================= */
.assignment-card .form-label {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 6px;
}

.assignment-select {
    height: 44px;
    padding: 8px 14px;
}

/* ================= Toggle ================= */
.switch {
    width: 44px;
    height: 22px;
    background: #e5e5e5;
    border-radius: 22px;
    position: relative;
    cursor: pointer;
    transition: background 0.3s ease;
}
.switch::after {
    content: "";
    width: 18px;
    height: 18px;
    background: #fff;
    position: absolute;
    top: 2px;
    left: var(--switch-left, 2px);
    border-radius: 50%;
    transition: left 0.3s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.switch.active {
    background: var(--primary);
}
.switch.active::after {
    left: 22px;
}

/* ================= Video Items ================= */
.video-item {
    transition: all 0.2s ease;
}

.video-item:hover {
    background-color: #f0edff !important;
    border-color: var(--primary) !important;
}

.remove-video-btn {
    padding: 4px 8px;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.remove-video-btn:hover {
    opacity: 1;
}

#videoList:empty::before {
    content: "No videos added yet. Upload files or add URLs above.";
    display: block;
    text-align: center;
    padding: 20px;
    color: var(--text-secondary);
    font-size: 14px;
    font-style: italic;
}
</style>
</head>

<body>

<div class="dashboard-container">
    <!-- Sidebar -->
    <div id="sidebar-container"></div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Header -->
        <div id="header-container"></div>

        <!-- Content -->
        <div class="content-wrapper">
            <main class="container-xl py-5">

                <!-- Page Title -->
                <div class="mb-4">
                    <h1 class="create-head">Create Lesson</h1>
                    <p class="text-muted">Lessons are used for competency-based self-learning content.</p>
                </div>

    <div class="row g-4">

        <!-- LEFT COLUMN -->
        <div class="col-lg-8">

            <!-- Basic Details -->
            <div class="card-box mb-4">
                <h5 class="fw-bold mb-3">Basic Details</h5>

                <div class="mb-3">
                    <label class="form-label">Lesson Title</label>
                    <input type="text" class="form-control" placeholder="e.g. Introduction to Financial Literacy">
                </div>

                <div class="mb-3">
                    <label class="form-label">Short Description</label>
                    <textarea rows="3" class="form-control" placeholder="Briefly describe what the student will learn..."></textarea>
                </div>

                <div>
                    <label class="form-label mb-2">Thumbnail</label>
                    <div class="upload-box">
                        <span class="material-symbols-outlined text-primary fs-2">add_photo_alternate</span>
                        <p class="mb-0 fw-medium">Click to upload or drag & drop</p>
                        <small class="text-muted">SVG, PNG, JPG (800Ã—400)</small>
                    </div>
                </div>
            </div>

            <!-- Learning Content -->
            <div class="card-box">
                <h5 class="fw-bold mb-3">Learning Content</h5>

                <div class="lesson-tabs mb-3">
                    <button class="active">Video</button>
                    <button>Article</button>
                    <button>Quiz</button>
                    <button>SCORM</button>
                </div>

                <!-- <label class="form-label mb-2">Article Content</label>

                <div class="border rounded">
                    <div class="editor-toolbar">
                        <button><span class="material-symbols-outlined">format_bold</span></button>
                        <button><span class="material-symbols-outlined">format_italic</span></button>
                        <button><span class="material-symbols-outlined">format_list_bulleted</span></button>
                        <button><span class="material-symbols-outlined">link</span></button>
                    </div>
                    <textarea rows="10" class="form-control border-0" placeholder="Start writing your lesson content here..."></textarea>
                </div> -->
            </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="col-lg-4">

            <!-- Actions -->
            <div class="card-box mb-4">
                <button class="btn btn-primary-custom w-100 mb-3 publish-btn">Publish Lesson</button>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary-custom w-50 draft-btn">Save Draft</button>
                    <button class="btn w-50">Cancel</button>
                </div>
            </div>

            <!-- Assignment -->
            <div class="card-box assignment-card mb-4">
                <h5 class="fw-bold mb-4 d-flex align-items-center gap-2">
                    <span class="material-symbols-outlined text-primary">school</span>
                    Assignment
                </h5>

                <div class="mb-3">
                    <label class="form-label">Competency</label>
                    <select class="form-select assignment-select">
                        <option selected disabled>Select Competency</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Level</label>
                    <select class="form-select assignment-select">
                        <option selected disabled>Select Difficulty</option>
                    </select>
                </div>

                <div>
                    <label class="form-label">Module / Category</label>
                    <select class="form-select assignment-select">
                        <option selected disabled>Select Module</option>
                    </select>
                </div>
            </div>

            <!-- Visibility -->
            <div class="card-box">
                <h5 class="fw-bold mb-3">Visibility</h5>

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <strong>Status</strong>
                        <div class="text-muted small">Draft or Published</div>
                    </div>
                    <div class="switch"></div>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>Recommend for Low Competency</strong>
                        <div class="text-muted small">Suggest to struggling students</div>
                    </div>
                    <div class="switch"></div>
                </div>
            </div>

        </div>
    </div>

            </main>
        </div>
    </div>
</div>

<script>
    // Load sidebar
    fetch('sidebar.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('sidebar-container').innerHTML = data;
            document.getElementById('sidebar-container').classList.add('loaded');
        })
        .catch(error => console.error('Error loading sidebar:', error));

    // Load header
    fetch('header.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('header-container').innerHTML = data;
            document.getElementById('header-container').classList.add('loaded');
        })
        .catch(error => console.error('Error loading header:', error));

    // ================= Lesson Content Tabs =================
    document.addEventListener('DOMContentLoaded', function() {
        const tabButtons = document.querySelectorAll('.lesson-tabs button');
        const contentAreas = {
            'Video': createVideoContent(),
            'Article': createArticleContent(),
            'Quiz': createQuizContent(),
            'SCORM': createScormContent()
        };

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                tabButtons.forEach(btn => btn.classList.remove('active'));

                // Add active class to clicked button
                this.classList.add('active');

                // Update content area based on selected tab
                const selectedTab = this.textContent.trim();
                updateContentArea(selectedTab, contentAreas[selectedTab]);
            });
        });

        // Content creators for different tab types
        function createVideoContent() {
            return `
                <label class="form-label mb-2">Add Videos</label>
                <div id="videoList" class="mb-3"></div>
                <div class="upload-box video-upload-box" style="cursor: pointer;">
                    <span class="material-symbols-outlined text-primary fs-2">video_library</span>
                    <p class="mb-0 fw-medium">Click to upload videos</p>
                    <small class="text-muted">MP4, WebM, MOV (Max 500MB per file) - Multiple files supported</small>
                </div>
                <div class="text-center text-muted my-3">â€” OR â€”</div>
                <div class="d-flex gap-2 align-items-center">
                    <input type="url" class="form-control video-url-input" placeholder="Enter YouTube or Vimeo URL">
                    <button type="button" class="btn btn-outline-primary-custom add-url-btn" style="white-space: nowrap;">Add URL</button>
                </div>
            `;
        }

        function createArticleContent() {
            return `
                <label class="form-label mb-2">Article Content</label>
                <div class="border rounded">
                    <div class="editor-toolbar">
                        <button type="button" data-command="bold"><span class="material-symbols-outlined">format_bold</span></button>
                        <button type="button" data-command="italic"><span class="material-symbols-outlined">format_italic</span></button>
                        <button type="button" data-command="insertUnorderedList"><span class="material-symbols-outlined">format_list_bulleted</span></button>
                        <button type="button" data-command="createLink"><span class="material-symbols-outlined">link</span></button>
                    </div>
                    <div id="articleEditor" contenteditable="true" class="form-control border-0" style="min-height: 300px; outline: none;" placeholder="Start writing your lesson content here..."></div>
                </div>
            `;
        }

        function createQuizContent() {
            return `
                <label class="form-label mb-2">Quiz Questions</label>
                <div id="quizContainer">
                    <div class="quiz-question mb-3 p-3 border rounded">
                        <div class="mb-3">
                            <label class="form-label">Question 1</label>
                            <input type="text" class="form-control" placeholder="Enter your question">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Answer Options</label>
                            <div class="mb-2">
                                <input type="text" class="form-control" placeholder="Option A">
                            </div>
                            <div class="mb-2">
                                <input type="text" class="form-control" placeholder="Option B">
                            </div>
                            <div class="mb-2">
                                <input type="text" class="form-control" placeholder="Option C">
                            </div>
                            <div class="mb-2">
                                <input type="text" class="form-control" placeholder="Option D">
                            </div>
                        </div>
                        <select class="form-select">
                            <option selected disabled>Select Correct Answer</option>
                            <option>Option A</option>
                            <option>Option B</option>
                            <option>Option C</option>
                            <option>Option D</option>
                        </select>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-primary-custom w-100" onclick="addQuizQuestion()">
                    <span class="material-symbols-outlined" style="vertical-align: middle;">add</span>
                    Add Question
                </button>
            `;
        }

        function createScormContent() {
            return `
                <label class="form-label mb-2">SCORM Package Upload</label>
                <div class="upload-box">
                    <span class="material-symbols-outlined text-primary fs-2">upload_file</span>
                    <p class="mb-0 fw-medium">Click to upload SCORM package</p>
                    <small class="text-muted">ZIP file containing SCORM 1.2 or 2004 content</small>
                </div>
                <div class="alert alert-info mt-3">
                    <strong>Note:</strong> SCORM packages must include a valid manifest file (imsmanifest.xml)
                </div>
            `;
        }

        function updateContentArea(tabName, content) {
            const contentContainer = document.querySelector('.card-box:has(.lesson-tabs)');
            const existingContent = contentContainer.querySelector('.content-area');

            if (existingContent) {
                existingContent.remove();
            }

            const contentDiv = document.createElement('div');
            contentDiv.className = 'content-area';
            contentDiv.innerHTML = content;
            contentContainer.appendChild(contentDiv);

            // Re-attach handlers based on tab type
            if (tabName === 'Article') {
                attachEditorToolbar();
            } else if (tabName === 'Video') {
                attachVideoHandlers();
            }
        }

        // Editor toolbar functionality
        function attachEditorToolbar() {
            const toolbarButtons = document.querySelectorAll('.editor-toolbar button');
            toolbarButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const command = this.getAttribute('data-command');
                    if (command === 'createLink') {
                        const url = prompt('Enter URL:');
                        if (url) {
                            document.execCommand(command, false, url);
                        }
                    } else {
                        document.execCommand(command, false, null);
                    }
                });
            });
        }

        // Video upload functionality
        let videoItems = [];

        function attachVideoHandlers() {
            const uploadBox = document.querySelector('.video-upload-box');
            const addUrlBtn = document.querySelector('.add-url-btn');
            const urlInput = document.querySelector('.video-url-input');

            // File upload handler
            if (uploadBox) {
                uploadBox.addEventListener('click', function() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'video/*';
                    input.multiple = true;

                    input.addEventListener('change', function(e) {
                        const files = Array.from(e.target.files);
                        files.forEach(file => {
                            if (file.type.startsWith('video/')) {
                                addVideoItem(file.name, 'file', file);
                            }
                        });
                    });

                    input.click();
                });
            }

            // URL handler
            if (addUrlBtn) {
                addUrlBtn.addEventListener('click', function() {
                    const url = urlInput.value.trim();
                    if (url) {
                        if (isValidVideoURL(url)) {
                            addVideoItem(url, 'url', null);
                            urlInput.value = '';
                        } else {
                            alert('Please enter a valid YouTube or Vimeo URL.');
                        }
                    }
                });

                urlInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addUrlBtn.click();
                    }
                });
            }
        }

        function isValidVideoURL(url) {
            const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/;
            const vimeoRegex = /^(https?:\/\/)?(www\.)?vimeo\.com\/.+/;
            return youtubeRegex.test(url) || vimeoRegex.test(url);
        }

        function addVideoItem(name, type, fileData) {
            const videoId = Date.now() + Math.random();
            videoItems.push({ id: videoId, name, type, fileData });

            const videoList = document.getElementById('videoList');
            const videoItem = document.createElement('div');
            videoItem.className = 'video-item mb-2 p-3 border rounded d-flex align-items-center justify-content-between';
            videoItem.style.backgroundColor = '#faf9fb';
            videoItem.dataset.videoId = videoId;

            const icon = type === 'file' ? 'video_file' : 'link';
            const displayName = type === 'file' ? name : new URL(name).hostname + ' - ' + name.substring(0, 50) + '...';

            videoItem.innerHTML = `
                <div class="d-flex align-items-center gap-2 flex-grow-1">
                    <span class="material-symbols-outlined text-primary">${icon}</span>
                    <div>
                        <div class="fw-medium" style="font-size: 14px;">${name}</div>
                        <small class="text-muted">${type === 'file' ? 'Video File' : 'Video URL'}</small>
                    </div>
                </div>
                <button type="button" class="btn btn-sm btn-danger remove-video-btn" onclick="removeVideoItem(${videoId})">
                    <span class="material-symbols-outlined" style="font-size: 18px;">close</span>
                </button>
            `;

            videoList.appendChild(videoItem);
        }

        window.removeVideoItem = function(videoId) {
            videoItems = videoItems.filter(item => item.id !== videoId);
            const videoItem = document.querySelector(`[data-video-id="${videoId}"]`);
            if (videoItem) {
                videoItem.remove();
            }
        };

        // Initialize with Video content
        updateContentArea('Video', contentAreas['Video']);
    });

    // ================= Toggle Switches =================
    document.addEventListener('DOMContentLoaded', function() {
        const switches = document.querySelectorAll('.switch');

        switches.forEach(switchEl => {
            switchEl.addEventListener('click', function() {
                this.classList.toggle('active');
            });
        });
    });

    // ================= File Upload Handling =================
    document.addEventListener('DOMContentLoaded', function() {
        // Thumbnail upload
        const uploadBoxes = document.querySelectorAll('.upload-box');

        uploadBoxes.forEach(box => {
            box.addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';

                input.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            box.innerHTML = `
                                <img src="${event.target.result}" alt="Preview" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                                <p class="mb-0 fw-medium mt-2">${file.name}</p>
                                <small class="text-muted">Click to change</small>
                            `;
                        };
                        reader.readAsDataURL(file);
                    }
                });

                input.click();
            });

            // Drag and drop
            box.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--primary)';
                this.style.background = 'var(--primary-light, #f8f4fa)';
            });

            box.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--border-color)';
                this.style.background = 'var(--bg-light)';
            });

            box.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--border-color)';
                this.style.background = 'var(--bg-light)';

                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        box.innerHTML = `
                            <img src="${event.target.result}" alt="Preview" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                            <p class="mb-0 fw-medium mt-2">${file.name}</p>
                            <small class="text-muted">Click to change</small>
                        `;
                    };
                    reader.readAsDataURL(file);
                }
            });
        });
    });

    // ================= Quiz Question Management =================
    let questionCount = 1;

    function addQuizQuestion() {
        questionCount++;
        const quizContainer = document.getElementById('quizContainer');
        const newQuestion = document.createElement('div');
        newQuestion.className = 'quiz-question mb-3 p-3 border rounded position-relative';
        newQuestion.innerHTML = `
            <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2" onclick="removeQuestion(this)">
                <span class="material-symbols-outlined" style="font-size: 18px;">close</span>
            </button>
            <div class="mb-3">
                <label class="form-label">Question ${questionCount}</label>
                <input type="text" class="form-control" placeholder="Enter your question">
            </div>
            <div class="mb-2">
                <label class="form-label">Answer Options</label>
                <div class="mb-2">
                    <input type="text" class="form-control" placeholder="Option A">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" placeholder="Option B">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" placeholder="Option C">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" placeholder="Option D">
                </div>
            </div>
            <select class="form-select">
                <option selected disabled>Select Correct Answer</option>
                <option>Option A</option>
                <option>Option B</option>
                <option>Option C</option>
                <option>Option D</option>
            </select>
        `;
        quizContainer.appendChild(newQuestion);
    }

    function removeQuestion(button) {
        const questionDiv = button.closest('.quiz-question');
        questionDiv.remove();

        // Renumber remaining questions
        const questions = document.querySelectorAll('.quiz-question');
        questions.forEach((q, index) => {
            const label = q.querySelector('label');
            if (label) {
                label.textContent = `Question ${index + 1}`;
            }
        });
        questionCount = questions.length;
    }

    // ================= Form Submission =================
    document.addEventListener('DOMContentLoaded', function() {
        const publishBtn = document.querySelector('.btn-primary-custom');
        const saveDraftBtn = document.querySelector('.btn-outline-primary-custom');
        const cancelBtn = document.querySelector('.card-box .btn:not(.btn-primary-custom):not(.btn-outline-primary-custom)');

        if (publishBtn) {
            publishBtn.addEventListener('click', function() {
                if (validateForm()) {
                    const title = document.querySelector('input[placeholder*="Introduction to Financial"]').value.trim();
                    alert(`âœ… Lesson Published Successfully!\n\n"${title}" has been published and is now available in the lesson library.`);
                    window.location.href = 'lessons-library.html';
                }
            });
        }

        if (saveDraftBtn) {
            saveDraftBtn.addEventListener('click', function() {
                if (validateForm(false)) {
                    const title = document.querySelector('input[placeholder*="Introduction to Financial"]').value.trim();
                    alert(`ðŸ’¾ Draft Saved Successfully!\n\n"${title}" has been saved as a draft. You can continue editing it later from the lesson library.`);
                    window.location.href = 'lessons-library.html';
                }
            });
        }

        if (cancelBtn) {
            cancelBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to cancel? Any unsaved changes will be lost.')) {
                    window.location.href = 'lessons-library.html';
                }
            });
        }

        function validateForm(fullValidation = true) {
            const title = document.querySelector('input[placeholder*="Introduction to Financial"]');
            const description = document.querySelector('textarea[placeholder*="Briefly describe"]');

            if (!title || !title.value.trim()) {
                alert('Please enter a lesson title.');
                title.focus();
                return false;
            }

            if (fullValidation && (!description || !description.value.trim())) {
                alert('Please enter a short description.');
                description.focus();
                return false;
            }

            return true;
        }
    });
</script>

</body>
</html>
