<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Attendance Report - Enpower Skill Lab</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="mark-attendance.css">
</head>

<body>
    <div class="dashboard-container">
        <!-- Include Sidebar Component -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Include Header Component -->
            <div id="header-container"></div>
            <div class="content-wrapper">
                <div class="page-content">
                    <div class="page-header">
                        <h1 class="page-title">Session Attendance Management</h1>
                        <p class="page-subtitle">Mark attendance for 48 sessions (4 sessions per month)</p>
                    </div>

                    <!-- Mark Attendance Section -->
                    <div class="card mark-attendance-card">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="material-symbols-outlined">edit_calendar</span>
                                Mark Session Attendance
                            </h2>
                        </div>
                        <div class="mark-attendance-content">
                            <!-- Session Selection -->
                            <div class="session-selector-wrapper">
                                <div class="session-selector">
                                    <label for="monthSelect">Select Month</label>
                                    <select id="monthSelect" class="month-select">
                                        <option value="0">January</option>
                                        <option value="1">February</option>
                                        <option value="2">March</option>
                                        <option value="3">April</option>
                                        <option value="4">May</option>
                                        <option value="5">June</option>
                                        <option value="6">July</option>
                                        <option value="7">August</option>
                                        <option value="8">September</option>
                                        <option value="9">October</option>
                                        <option value="10">November</option>
                                        <option value="11">December</option>
                                    </select>
                                </div>
                                <div class="session-selector">
                                    <label for="sessionSelect">Select Session</label>
                                    <select id="sessionSelect" class="session-select">
                                        <option value="1">Session 1</option>
                                        <option value="2">Session 2</option>
                                        <option value="3">Session 3</option>
                                        <option value="4">Session 4</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Session Info Display -->
                            <div class="session-info-card">
                                <div class="session-info-header">
                                    <span class="material-symbols-outlined">event</span>
                                    <span id="sessionInfoText">Session 1 of January</span>
                                </div>
                                <div class="session-details">
                                    <div class="detail-item">
                                        <span class="detail-label">Session Number:</span>
                                        <span class="detail-value" id="sessionNumber">1 of 48</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Current Status:</span>
                                        <span class="detail-value" id="currentStatus">Not Marked</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Attendance Status Buttons -->
                            <div class="attendance-status-buttons">
                                <button class="status-btn present-btn" data-status="present">
                                    <span class="material-symbols-outlined">check_circle</span>
                                    Present
                                </button>
                                <button class="status-btn leave-btn" data-status="leave">
                                    <span class="material-symbols-outlined">event_busy</span>
                                    Leave
                                </button>
                                <button class="status-btn absent-btn" data-status="absent">
                                    <span class="material-symbols-outlined">cancel</span>
                                    Absent
                                </button>
                            </div>

                            <div class="selected-status" id="selectedStatus">
                                <p class="status-message">Please select attendance status for this session</p>
                            </div>

                            <button class="submit-attendance-btn" id="submitAttendance">
                                <span class="material-symbols-outlined">save</span>
                                Submit Session Attendance
                            </button>
                        </div>
                    </div>

                    <!-- Attendance Report Section -->
                    <div class="card attendance-report-card">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="material-symbols-outlined">assessment</span>
                                Session Attendance Report
                            </h2>
                            <div class="report-controls">
                                <select class="month-selector" id="reportMonth">
                                    <option value="all">All Months</option>
                                    <option value="0">January</option>
                                    <option value="1">February</option>
                                    <option value="2">March</option>
                                    <option value="3">April</option>
                                    <option value="4">May</option>
                                    <option value="5">June</option>
                                    <option value="6">July</option>
                                    <option value="7">August</option>
                                    <option value="8">September</option>
                                    <option value="9">October</option>
                                    <option value="10">November</option>
                                    <option value="11">December</option>
                                </select>
                            </div>
                        </div>

                        <div class="legend">
                            <span class="legend-item">
                                <span class="legend-dot blue"></span>P - Present
                            </span>
                            <span class="legend-item">
                                <span class="legend-dot purple"></span>L - Leave
                            </span>
                            <span class="legend-item">
                                <span class="legend-dot red"></span>A - Absent
                            </span>
                            <span class="legend-item">
                                <span class="legend-dot gray"></span>N - Not Marked
                            </span>
                        </div>

                        <!-- Overall Statistics -->
                        <div class="charts-wrapper">
                            <div class="chart-container">
                                <svg class="rotate-90" width="120" height="120">
                                    <circle cx="60" cy="60" fill="none" r="50" stroke="#e5e7eb" stroke-width="10"></circle>
                                    <circle cx="60" cy="60" fill="none" r="50" stroke="#6b277e" stroke-dasharray="314" stroke-dashoffset="235" stroke-width="10"></circle>
                                </svg>
                                <div class="chart-label">
                                    <span class="chart-percent" id="overallPercent">25%</span>
                                    <span class="chart-text">Overall</span>
                                </div>
                            </div>
                            <div class="chart-container">
                                <svg class="rotate-90" width="120" height="120">
                                    <circle cx="60" cy="60" fill="none" r="50" stroke="#e5e7eb" stroke-width="10"></circle>
                                    <circle cx="60" cy="60" fill="none" r="50" stroke="#6b277e" stroke-dasharray="314" stroke-dashoffset="157" stroke-width="10"></circle>
                                </svg>
                                <div class="chart-label">
                                    <span class="chart-percent" id="monthPercent">50%</span>
                                    <span class="chart-text" id="monthLabel">This Month</span>
                                </div>
                            </div>
                        </div>

                        <div class="stats-grid">
                            <div class="stat-card blue">
                                <p class="stat-label blue">PRESENTS</p>
                                <p class="stat-value blue" id="presentCount">12</p>
                                <p class="stat-period blue">Out of 48</p>
                            </div>
                            <div class="stat-card purple">
                                <p class="stat-label purple">LEAVES</p>
                                <p class="stat-value purple" id="leaveCount">2</p>
                                <p class="stat-period purple">Out of 48</p>
                            </div>
                            <div class="stat-card red">
                                <p class="stat-label red">ABSENTS</p>
                                <p class="stat-value red" id="absentCount">3</p>
                                <p class="stat-period red">Out of 48</p>
                            </div>
                            <div class="stat-card gray">
                                <p class="stat-label gray">NOT MARKED</p>
                                <p class="stat-value gray" id="notMarkedCount">31</p>
                                <p class="stat-period gray">Out of 48</p>
                            </div>
                        </div>

                        <!-- Session Grid View -->
                        <div class="sessions-view">
                            <h3 class="calendar-title">Sessions Overview</h3>
                            <div id="sessionsGrid" class="sessions-grid">
                                <!-- Sessions will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Parent Notification Section -->
                    <div class="card parent-notification-card">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="material-symbols-outlined">notifications_active</span>
                                Parent Notification
                            </h2>
                        </div>
                        <div class="notification-content">
                            <div class="notification-settings">
                                <div class="setting-item">
                                    <label class="toggle-label">
                                        <input type="checkbox" class="toggle-checkbox" id="notifyAbsent" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-text">Notify on Absent</span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <label class="toggle-label">
                                        <input type="checkbox" class="toggle-checkbox" id="notifyLeave" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-text">Notify on Leave</span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <label class="toggle-label">
                                        <input type="checkbox" class="toggle-checkbox" id="sessionReport">
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-text">Send Session Report</span>
                                    </label>
                                </div>
                            </div>

                            <div class="notification-history">
                                <h3 class="history-title">Recent Notifications</h3>
                                <div class="notification-list">
                                    <div class="notification-item">
                                        <div class="notification-icon absent">
                                            <span class="material-symbols-outlined">cancel</span>
                                        </div>
                                        <div class="notification-details">
                                            <h4 class="notification-title">Absent Alert - Session 12</h4>
                                            <p class="notification-message">Student marked absent for March Session 4</p>
                                            <span class="notification-time">2 days ago</span>
                                        </div>
                                    </div>
                                    <div class="notification-item">
                                        <div class="notification-icon leave">
                                            <span class="material-symbols-outlined">event_busy</span>
                                        </div>
                                        <div class="notification-details">
                                            <h4 class="notification-title">Leave - Session 11</h4>
                                            <p class="notification-message">Student on leave for March Session 3</p>
                                            <span class="notification-time">4 days ago</span>
                                        </div>
                                    </div>
                                    <div class="notification-item">
                                        <div class="notification-icon present">
                                            <span class="material-symbols-outlined">check_circle</span>
                                        </div>
                                        <div class="notification-details">
                                            <h4 class="notification-title">Perfect Attendance</h4>
                                            <p class="notification-message">5 consecutive sessions attended</p>
                                            <span class="notification-time">1 week ago</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="send-notification">
                                <h3 class="send-title">Send Custom Notification</h3>
                                <textarea class="notification-textarea" placeholder="Type your message to parents..."></textarea>
                                <button class="send-notification-btn">
                                    <span class="material-symbols-outlined">send</span>
                                    Send to Parents
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Load Sidebar and Header Components
        Promise.all([
            fetch('sidebar.html').then(response => response.text()),
            fetch('header.html').then(response => response.text())
        ]).then(([sidebarHTML, headerHTML]) => {
            // Insert both components
            document.getElementById('sidebar-container').innerHTML = sidebarHTML;
            document.getElementById('header-container').innerHTML = headerHTML;

            // Initialize sidebar functionality after both components are loaded
            initializeSidebar();
            initializeSidebarDropdowns();
        });

        function initializeSidebar() {
            const menuToggle = document.getElementById('menuToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            function toggleSidebar() {
                if (window.innerWidth >= 1024) {
                    sidebar.classList.toggle('collapsed');
                } else {
                    sidebar.classList.add('active');
                    sidebarOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            function closeSidebarFunc() {
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            menuToggle.addEventListener('click', toggleSidebar);
            closeSidebar.addEventListener('click', closeSidebarFunc);
            sidebarOverlay.addEventListener('click', closeSidebarFunc);

            const sidebarLinks = sidebar.querySelectorAll('a');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 1024) {
                        closeSidebarFunc();
                    }
                });
            });

            window.addEventListener('resize', () => {
                if (window.innerWidth >= 1024) {
                    closeSidebarFunc();
                } else {
                    sidebar.classList.remove('collapsed');
                }
            });

            // Set active link
            setActiveLink();
        }

        function setActiveLink() {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = {
                'dashboard.html': 'nav-dashboard',
                'mark-attendance.html': 'nav-attendance',
                'lms.html': 'nav-lms',
                'leaderboard.html': 'nav-leaderboard',
                'assessment.html': 'nav-assessment',
                'reports.html': 'nav-reports',
                'badges.html': 'nav-badges',
                'event-calendar.html': 'nav-event-calendar',
                'newsletter.html': 'nav-newsletter',
                'announcements.html': 'nav-announcements'
            };

            const sidebar = document.getElementById('sidebar');
            const sidebarLinks = sidebar.querySelectorAll('a');
            sidebarLinks.forEach(link => link.classList.remove('active'));

            if (navLinks[currentPage]) {
                const activeLink = document.getElementById(navLinks[currentPage]);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            }
        }

        function initializeSidebarDropdowns() {
            const dropdownToggles = document.querySelectorAll('.sidebar-dropdown-toggle');

            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();

                    const dropdownParent = this.closest('.sidebar-dropdown');
                    const isActive = dropdownParent.classList.contains('active');

                    // Close all other dropdowns
                    document.querySelectorAll('.sidebar-dropdown').forEach(dropdown => {
                        dropdown.classList.remove('active');
                    });

                    // Toggle current dropdown
                    if (!isActive) {
                        dropdownParent.classList.add('active');
                    }
                });
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.sidebar-dropdown')) {
                    document.querySelectorAll('.sidebar-dropdown').forEach(dropdown => {
                        dropdown.classList.remove('active');
                    });
                }
            });
        }

        // Session-based Attendance System
        const TOTAL_SESSIONS = 48;
        const SESSIONS_PER_MONTH = 4;
        const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

        // Sample attendance data (session_number: status)
        // In production, this would come from your backend
        const attendanceData = {
            1: 'present',
            2: 'present',
            3: 'present',
            4: 'leave',
            5: 'present',
            6: 'present',
            7: 'present',
            8: 'absent',
            9: 'present',
            10: 'present',
            11: 'present',
            12: 'absent'
        };

        // Mark Attendance Functionality
        const monthSelect = document.getElementById('monthSelect');
        const sessionSelect = document.getElementById('sessionSelect');
        const statusButtons = document.querySelectorAll('.status-btn');
        const selectedStatus = document.getElementById('selectedStatus');
        const submitBtn = document.getElementById('submitAttendance');
        const sessionInfoText = document.getElementById('sessionInfoText');
        const sessionNumber = document.getElementById('sessionNumber');
        const currentStatus = document.getElementById('currentStatus');

        let selectedAttendanceStatus = null;
        let currentSessionNumber = 1;

        // Set current month as default
        const today = new Date();
        monthSelect.value = today.getMonth();

        function updateSessionInfo() {
            const month = parseInt(monthSelect.value);
            const session = parseInt(sessionSelect.value);

            currentSessionNumber = (month * SESSIONS_PER_MONTH) + session;

            sessionInfoText.textContent = `Session ${session} of ${MONTHS[month]}`;
            sessionNumber.textContent = `${currentSessionNumber} of ${TOTAL_SESSIONS}`;

            // Update current status
            const status = attendanceData[currentSessionNumber];
            if (status) {
                const statusText = status.charAt(0).toUpperCase() + status.slice(1);
                currentStatus.textContent = statusText;
                currentStatus.style.color = status === 'present' ? 'var(--blue-500)' : status === 'leave' ? 'var(--purple-500)' : 'var(--red-500)';
            } else {
                currentStatus.textContent = 'Not Marked';
                currentStatus.style.color = 'var(--gray-500)';
            }

            // Reset selection
            statusButtons.forEach(b => b.classList.remove('active'));
            selectedAttendanceStatus = null;
            selectedStatus.innerHTML = '<p class="status-message">Please select attendance status for this session</p>';
        }

        monthSelect.addEventListener('change', updateSessionInfo);
        sessionSelect.addEventListener('change', updateSessionInfo);

        // Handle status button clicks
        statusButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all buttons
                statusButtons.forEach(b => b.classList.remove('active'));

                // Add active class to clicked button
                btn.classList.add('active');

                // Update current status
                selectedAttendanceStatus = btn.dataset.status;

                // Update status message
                const statusMessages = {
                    'present': 'Status selected: <strong style="color: var(--blue-500);">Present</strong>',
                    'leave': 'Status selected: <strong style="color: var(--purple-500);">Leave</strong>',
                    'absent': 'Status selected: <strong style="color: var(--red-500);">Absent</strong>'
                };

                selectedStatus.innerHTML = `<p class="status-message">${statusMessages[selectedAttendanceStatus]}</p>`;
            });
        });

        // Handle submit attendance
        submitBtn.addEventListener('click', () => {
            if (!selectedAttendanceStatus) {
                alert('Please select an attendance status');
                return;
            }

            // Here you would typically send this to your backend
            console.log('Submitting attendance:', {
                sessionNumber: currentSessionNumber,
                month: MONTHS[parseInt(monthSelect.value)],
                session: sessionSelect.value,
                status: selectedAttendanceStatus
            });

            // Update local data
            attendanceData[currentSessionNumber] = selectedAttendanceStatus;

            alert(`Session ${currentSessionNumber} attendance marked as ${selectedAttendanceStatus}`);

            // Update displays
            updateSessionInfo();
            renderSessionsGrid();
            updateStatistics();
        });

        // Initialize
        updateSessionInfo();

        // Attendance Report Functionality
        const reportMonth = document.getElementById('reportMonth');
        const sessionsGrid = document.getElementById('sessionsGrid');

        function getSessionLabel(sessionNum) {
            const month = Math.floor((sessionNum - 1) / SESSIONS_PER_MONTH);
            const session = ((sessionNum - 1) % SESSIONS_PER_MONTH) + 1;
            return `${MONTHS[month]} S${session}`;
        }

        function renderSessionsGrid() {
            const filterMonth = reportMonth.value;
            sessionsGrid.innerHTML = '';

            for (let i = 1; i <= TOTAL_SESSIONS; i++) {
                const month = Math.floor((i - 1) / SESSIONS_PER_MONTH);

                // Filter by month if selected
                if (filterMonth !== 'all' && month !== parseInt(filterMonth)) {
                    continue;
                }

                const sessionCard = document.createElement('div');
                sessionCard.className = 'session-card';

                const status = attendanceData[i] || 'not-marked';
                sessionCard.classList.add(status);

                const sessionLabel = getSessionLabel(i);
                const statusIcon = status === 'present' ? 'check_circle' :
                                 status === 'leave' ? 'event_busy' :
                                 status === 'absent' ? 'cancel' : 'schedule';

                const statusText = status === 'not-marked' ? 'Not Marked' : status.charAt(0).toUpperCase() + status.slice(1);

                sessionCard.innerHTML = `
                    <div class="session-card-header">
                        <span class="session-label">Session ${i}</span>
                        <span class="material-symbols-outlined session-icon">${statusIcon}</span>
                    </div>
                    <div class="session-card-body">
                        <span class="session-month-label">${sessionLabel}</span>
                        <span class="session-status-text">${statusText}</span>
                    </div>
                `;

                sessionsGrid.appendChild(sessionCard);
            }
        }

        function updateStatistics() {
            let present = 0, leave = 0, absent = 0, notMarked = 0;

            for (let i = 1; i <= TOTAL_SESSIONS; i++) {
                const status = attendanceData[i];
                if (status === 'present') present++;
                else if (status === 'leave') leave++;
                else if (status === 'absent') absent++;
                else notMarked++;
            }

            document.getElementById('presentCount').textContent = present;
            document.getElementById('leaveCount').textContent = leave;
            document.getElementById('absentCount').textContent = absent;
            document.getElementById('notMarkedCount').textContent = notMarked;

            // Update charts
            const overallPercentage = Math.round((present / TOTAL_SESSIONS) * 100);
            document.getElementById('overallPercent').textContent = overallPercentage + '%';

            // Calculate stroke dashoffset (314 is circumference, goes from 314 to 0)
            const overallOffset = 314 - (314 * (present / TOTAL_SESSIONS));
            document.querySelector('.charts-wrapper .chart-container:first-child circle:last-child').setAttribute('stroke-dashoffset', overallOffset);
        }

        // Initialize sessions grid
        renderSessionsGrid();
        updateStatistics();

        // Update grid when filter changes
        reportMonth.addEventListener('change', renderSessionsGrid);

        // Send Notification Functionality
        const sendNotificationBtn = document.querySelector('.send-notification-btn');
        const notificationTextarea = document.querySelector('.notification-textarea');

        sendNotificationBtn.addEventListener('click', () => {
            const message = notificationTextarea.value.trim();

            if (!message) {
                alert('Please enter a message');
                return;
            }

            // Here you would typically send this to your backend
            console.log('Sending notification:', message);
            alert('Notification sent to parents successfully!');

            // Clear textarea
            notificationTextarea.value = '';
        });
    </script>
</body>

</html>
